(self.webpackChunkmetaverse_experience=self.webpackChunkmetaverse_experience||[]).push([[555],{9150:(t,e,i)=>{var a=i(3687),s=i(70),n=s.GRAVITY,o=s.CONTACT_MATERIAL;const{TYPE:r}=i(70);var l=i(4025),p=i(6478),c=i(5540),d=i(9899);i(6261),t.exports=AFRAME.registerSystem("physics",{schema:{driver:{default:"local",oneOf:["local","worker","network","ammo"]},networkUrl:{default:"",if:{driver:"network"}},workerFps:{default:60,if:{driver:"worker"}},workerInterpolate:{default:!0,if:{driver:"worker"}},workerInterpBufferSize:{default:2,if:{driver:"worker"}},workerEngine:{default:"cannon",if:{driver:"worker"},oneOf:["cannon"]},workerDebug:{default:!1,if:{driver:"worker"}},gravity:{default:n},iterations:{default:s.ITERATIONS},friction:{default:o.friction},restitution:{default:o.restitution},contactEquationStiffness:{default:o.contactEquationStiffness},contactEquationRelaxation:{default:o.contactEquationRelaxation},frictionEquationStiffness:{default:o.frictionEquationStiffness},frictionEquationRegularization:{default:o.frictionEquationRegularization},maxInterval:{default:4/60},debug:{default:!1},debugDrawMode:{default:THREE.AmmoDebugConstants.NoDebug},maxSubSteps:{default:4},fixedTimeStep:{default:1/60},stats:{type:"array",default:[]}},async init(){var t=this.data;switch(this.debug=t.debug,this.initStats(),this.callbacks={beforeStep:[],step:[],afterStep:[]},this.listeners={},this.driver=null,t.driver){case"local":this.driver=new l;break;case"ammo":this.driver=new d;break;case"network":this.driver=new c(t.networkUrl);break;case"worker":this.driver=new p({fps:t.workerFps,engine:t.workerEngine,interpolate:t.workerInterpolate,interpolationBufferSize:t.workerInterpBufferSize,debug:t.workerDebug});break;default:throw new Error('[physics] Driver not recognized: "%s".',t.driver)}"ammo"!==t.driver?(await this.driver.init({quatNormalizeSkip:0,quatNormalizeFast:!1,solverIterations:t.iterations,gravity:t.gravity}),this.driver.addMaterial({name:"defaultMaterial"}),this.driver.addMaterial({name:"staticMaterial"}),this.driver.addContactMaterial("defaultMaterial","defaultMaterial",{friction:t.friction,restitution:t.restitution,contactEquationStiffness:t.contactEquationStiffness,contactEquationRelaxation:t.contactEquationRelaxation,frictionEquationStiffness:t.frictionEquationStiffness,frictionEquationRegularization:t.frictionEquationRegularization}),this.driver.addContactMaterial("staticMaterial","defaultMaterial",{friction:1,restitution:0,contactEquationStiffness:t.contactEquationStiffness,contactEquationRelaxation:t.contactEquationRelaxation,frictionEquationStiffness:t.frictionEquationStiffness,frictionEquationRegularization:t.frictionEquationRegularization})):await this.driver.init({gravity:t.gravity,debugDrawMode:t.debugDrawMode,solverIterations:t.iterations,maxSubSteps:t.maxSubSteps,fixedTimeStep:t.fixedTimeStep}),this.initialized=!0,this.debug&&this.setDebug(!0)},initStats(){if(this.statsToConsole=this.data.stats.includes("console"),this.statsToEvents=this.data.stats.includes("events"),this.statsToPanel=this.data.stats.includes("panel"),this.statsToConsole||this.statsToEvents||this.statsToPanel){this.trackPerf=!0,this.tickCounter=0,this.statsTickData={},this.statsBodyData={},this.countBodies={ammo:()=>this.countBodiesAmmo(),local:()=>this.countBodiesCannon(!1),worker:()=>this.countBodiesCannon(!0)},this.bodyTypeToStatsPropertyMap={ammo:{[r.STATIC]:"staticBodies",[r.KINEMATIC]:"kinematicBodies",[r.DYNAMIC]:"dynamicBodies"},cannon:{[a.Body.STATIC]:"staticBodies",[a.Body.DYNAMIC]:"dynamicBodies"}};this.el.sceneEl.setAttribute("stats-collector","inEvent: physics-tick-data;\n                                             properties: before, after, engine, total;\n                                             outputFrequency: 100;\n                                             outEvent: physics-tick-summary;\n                                             outputs: percentile__50, percentile__90, max")}if(this.statsToPanel){const t=this.el.sceneEl,e="&nbsp&nbsp&nbsp";t.setAttribute("stats-panel",""),t.setAttribute("stats-group__bodies","label: Physics Bodies"),t.setAttribute("stats-row__b1","group: bodies;\n                                           event:physics-body-data;\n                                           properties: staticBodies;\n                                           label: Static"),t.setAttribute("stats-row__b2","group: bodies;\n                                           event:physics-body-data;\n                                           properties: dynamicBodies;\n                                           label: Dynamic"),"local"===this.data.driver||"worker"===this.data.driver?t.setAttribute("stats-row__b3","group: bodies;\n                                             event:physics-body-data;\n                                             properties: contacts;\n                                             label: Contacts"):"ammo"===this.data.driver&&(t.setAttribute("stats-row__b3","group: bodies;\n                                             event:physics-body-data;\n                                             properties: kinematicBodies;\n                                             label: Kinematic"),t.setAttribute("stats-row__b4","group: bodies;\n                                             event: physics-body-data;\n                                             properties: manifolds;\n                                             label: Manifolds"),t.setAttribute("stats-row__b5","group: bodies;\n                                             event: physics-body-data;\n                                             properties: manifoldContacts;\n                                             label: Contacts"),t.setAttribute("stats-row__b6","group: bodies;\n                                             event: physics-body-data;\n                                             properties: collisions;\n                                             label: Collisions"),t.setAttribute("stats-row__b7","group: bodies;\n                                             event: physics-body-data;\n                                             properties: collisionKeys;\n                                             label: Coll Keys")),t.setAttribute("stats-group__tick",`label: Physics Ticks: Median${e}90th%${e}99th%`),t.setAttribute("stats-row__1","group: tick;\n                                          event:physics-tick-summary;\n                                          properties: before.percentile__50, \n                                                      before.percentile__90, \n                                                      before.max;\n                                          label: Before"),t.setAttribute("stats-row__2","group: tick;\n                                          event:physics-tick-summary;\n                                          properties: after.percentile__50, \n                                                      after.percentile__90, \n                                                      after.max; \n                                          label: After"),t.setAttribute("stats-row__3","group: tick; \n                                          event:physics-tick-summary; \n                                          properties: engine.percentile__50, \n                                                      engine.percentile__90, \n                                                      engine.max;\n                                          label: Engine"),t.setAttribute("stats-row__4","group: tick;\n                                          event:physics-tick-summary;\n                                          properties: total.percentile__50, \n                                                      total.percentile__90, \n                                                      total.max;\n                                          label: Total")}},tick:function(t,e){if(!this.initialized||!e)return;const i=performance.now();var a,s=this.callbacks;for(a=0;a<this.callbacks.beforeStep.length;a++)this.callbacks.beforeStep[a].beforeStep(t,e);const n=performance.now();this.driver.step(Math.min(e/1e3,this.data.maxInterval));const o=performance.now();for(a=0;a<s.step.length;a++)s.step[a].step(t,e);for(a=0;a<s.afterStep.length;a++)s.afterStep[a].afterStep(t,e);if(this.trackPerf){const t=performance.now();this.statsTickData.before=n-i,this.statsTickData.engine=o-n,this.statsTickData.after=t-o,this.statsTickData.total=t-i,this.el.emit("physics-tick-data",this.statsTickData),this.tickCounter++,100===this.tickCounter&&(this.countBodies[this.data.driver](),this.statsToConsole&&console.log("Physics body stats:",this.statsBodyData),(this.statsToEvents||this.statsToPanel)&&this.el.emit("physics-body-data",this.statsBodyData),this.tickCounter=0)}},countBodiesAmmo(){const t=this.statsBodyData;t.manifolds=this.driver.dispatcher.getNumManifolds(),t.manifoldContacts=0;for(let e=0;e<t.manifolds;e++){const i=this.driver.dispatcher.getManifoldByIndexInternal(e);t.manifoldContacts+=i.getNumContacts()}t.collisions=this.driver.collisions.size,t.collisionKeys=this.driver.collisionKeys.length,t.staticBodies=0,t.kinematicBodies=0,t.dynamicBodies=0,this.driver.els.forEach((e=>{const i=this.bodyTypeToStatsPropertyMap.ammo[function(t){return t.components["ammo-body"].data.type}(e)];t[i]++}))},countBodiesCannon(t){const e=this.statsBodyData;e.contacts=t?this.driver.contacts.length:this.driver.world.contacts.length,e.staticBodies=0,e.dynamicBodies=0;(t?Object.values(this.driver.bodies):this.driver.world.bodies).forEach((t=>{const i=this.bodyTypeToStatsPropertyMap.cannon[t.type];e[i]++}))},setDebug:function(t){this.debug=t,"ammo"===this.data.driver&&this.initialized&&(t&&!this.debugDrawer?(this.debugDrawer=this.driver.getDebugDrawer(this.el.object3D),this.debugDrawer.enable()):this.debugDrawer&&(this.debugDrawer.disable(),this.debugDrawer=null))},addBody:function(t,e,i){var a=this.driver;"local"===this.data.driver&&(t.__applyImpulse=t.applyImpulse,t.applyImpulse=function(){a.applyBodyMethod(t,"applyImpulse",arguments)},t.__applyForce=t.applyForce,t.applyForce=function(){a.applyBodyMethod(t,"applyForce",arguments)},t.updateProperties=function(){a.updateBodyProperties(t)},this.listeners[t.id]=function(e){t.el.emit("collide",e)},t.addEventListener("collide",this.listeners[t.id])),this.driver.addBody(t,e,i)},removeBody:function(t){this.driver.removeBody(t),"local"!==this.data.driver&&"worker"!==this.data.driver||(t.removeEventListener("collide",this.listeners[t.id]),delete this.listeners[t.id],t.applyImpulse=t.__applyImpulse,delete t.__applyImpulse,t.applyForce=t.__applyForce,delete t.__applyForce,delete t.updateProperties)},addConstraint:function(t){this.driver.addConstraint(t)},removeConstraint:function(t){this.driver.removeConstraint(t)},addComponent:function(t){var e=this.callbacks;t.beforeStep&&e.beforeStep.push(t),t.step&&e.step.push(t),t.afterStep&&e.afterStep.push(t)},removeComponent:function(t){var e=this.callbacks;t.beforeStep&&e.beforeStep.splice(e.beforeStep.indexOf(t),1),t.step&&e.step.splice(e.step.indexOf(t),1),t.afterStep&&e.afterStep.splice(e.afterStep.indexOf(t),1)},getContacts:function(){return this.driver.getContacts()},getMaterial:function(t){return this.driver.getMaterial(t)}})},7195:t=>{t.exports.slerp=function(t,e,i){if(i<=0)return t;if(i>=1)return e;var a=t[0],s=t[1],n=t[2],o=t[3],r=o*e[3]+a*e[0]+s*e[1]+n*e[2];if(!(r<0))return e;if((t=t.slice())[3]=-e[3],t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],(r=-r)>=1)return t[3]=o,t[0]=a,t[1]=s,t[2]=n,this;var l=Math.sqrt(1-r*r);if(Math.abs(l)<.001)return t[3]=.5*(o+t[3]),t[0]=.5*(a+t[0]),t[1]=.5*(s+t[1]),t[2]=.5*(n+t[2]),this;var p=Math.atan2(l,r),c=Math.sin((1-i)*p)/l,d=Math.sin(i*p)/l;return t[3]=o*c+t[3]*d,t[0]=a*c+t[0]*d,t[1]=s*c+t[1]*d,t[2]=n*c+t[2]*d,t}},7078:(t,e,i)=>{var a=i(3687),s=i(7195),n="__id";t.exports.ID=n;var o={};function r(t){var e={type:t.type};if(t.type===a.Shape.types.BOX)e.halfExtents=p(t.halfExtents);else if(t.type===a.Shape.types.SPHERE)e.radius=t.radius;else{if(t._type!==a.Shape.types.CYLINDER)throw new Error("Unimplemented shape type: %s",t.type);e.type=a.Shape.types.CYLINDER,e.radiusTop=t.radiusTop,e.radiusBottom=t.radiusBottom,e.height=t.height,e.numSegments=t.numSegments}return e}function l(t){var e;if(t.type===a.Shape.types.BOX)e=new a.Box(c(t.halfExtents));else if(t.type===a.Shape.types.SPHERE)e=new a.Sphere(t.radius);else{if(t.type!==a.Shape.types.CYLINDER)throw new Error("Unimplemented shape type: %s",t.type);(e=new a.Cylinder(t.radiusTop,t.radiusBottom,t.height,t.numSegments))._type=a.Shape.types.CYLINDER}return e}function p(t){return t.toArray()}function c(t){return new a.Vec3(t[0],t[1],t[2])}function d(t){return t.toArray()}function u(t){return new a.Quaternion(t[0],t[1],t[2],t[3])}t.exports.assignID=function(t,e){e[n]||(o[t]=o[t]||1,e[n]=t+"_"+o[t]++)},t.exports.serializeBody=function(t){return{shapes:t.shapes.map(r),shapeOffsets:t.shapeOffsets.map(p),shapeOrientations:t.shapeOrientations.map(d),position:p(t.position),quaternion:t.quaternion.toArray(),velocity:p(t.velocity),angularVelocity:p(t.angularVelocity),id:t[n],mass:t.mass,linearDamping:t.linearDamping,angularDamping:t.angularDamping,fixedRotation:t.fixedRotation,allowSleep:t.allowSleep,sleepSpeedLimit:t.sleepSpeedLimit,sleepTimeLimit:t.sleepTimeLimit}},t.exports.deserializeBodyUpdate=function(t,e){return e.position.set(t.position[0],t.position[1],t.position[2]),e.quaternion.set(t.quaternion[0],t.quaternion[1],t.quaternion[2],t.quaternion[3]),e.velocity.set(t.velocity[0],t.velocity[1],t.velocity[2]),e.angularVelocity.set(t.angularVelocity[0],t.angularVelocity[1],t.angularVelocity[2]),e.linearDamping=t.linearDamping,e.angularDamping=t.angularDamping,e.fixedRotation=t.fixedRotation,e.allowSleep=t.allowSleep,e.sleepSpeedLimit=t.sleepSpeedLimit,e.sleepTimeLimit=t.sleepTimeLimit,e.mass!==t.mass&&(e.mass=t.mass,e.updateMassProperties()),e},t.exports.deserializeInterpBodyUpdate=function(t,e,i,a){var n=1-a,o=a;i.position.set(t.position[0]*n+e.position[0]*o,t.position[1]*n+e.position[1]*o,t.position[2]*n+e.position[2]*o);var r=s.slerp(t.quaternion,e.quaternion,a);return i.quaternion.set(r[0],r[1],r[2],r[3]),i.velocity.set(t.velocity[0]*n+e.velocity[0]*o,t.velocity[1]*n+e.velocity[1]*o,t.velocity[2]*n+e.velocity[2]*o),i.angularVelocity.set(t.angularVelocity[0]*n+e.angularVelocity[0]*o,t.angularVelocity[1]*n+e.angularVelocity[1]*o,t.angularVelocity[2]*n+e.angularVelocity[2]*o),i.linearDamping=e.linearDamping,i.angularDamping=e.angularDamping,i.fixedRotation=e.fixedRotation,i.allowSleep=e.allowSleep,i.sleepSpeedLimit=e.sleepSpeedLimit,i.sleepTimeLimit=e.sleepTimeLimit,i.mass!==e.mass&&(i.mass=e.mass,i.updateMassProperties()),i},t.exports.deserializeBody=function(t){for(var e,i=new a.Body({mass:t.mass,position:c(t.position),quaternion:u(t.quaternion),velocity:c(t.velocity),angularVelocity:c(t.angularVelocity),linearDamping:t.linearDamping,angularDamping:t.angularDamping,fixedRotation:t.fixedRotation,allowSleep:t.allowSleep,sleepSpeedLimit:t.sleepSpeedLimit,sleepTimeLimit:t.sleepTimeLimit}),s=0;e=t.shapes[s];s++)i.addShape(l(e),c(t.shapeOffsets[s]),u(t.shapeOrientations[s]));return i[n]=t.id,i},t.exports.serializeShape=r,t.exports.deserializeShape=l,t.exports.serializeConstraint=function(t){var e={id:t[n],type:t.type,maxForce:t.maxForce,bodyA:t.bodyA[n],bodyB:t.bodyB[n]};switch(t.type){case"LockConstraint":break;case"DistanceConstraint":e.distance=t.distance;break;case"HingeConstraint":case"ConeTwistConstraint":e.axisA=p(t.axisA),e.axisB=p(t.axisB),e.pivotA=p(t.pivotA),e.pivotB=p(t.pivotB);break;case"PointToPointConstraint":e.pivotA=p(t.pivotA),e.pivotB=p(t.pivotB);break;default:throw new Error("Unexpected constraint type: "+t.type+'. You may need to manually set `constraint.type = "FooConstraint";`.')}return e},t.exports.deserializeConstraint=function(t,e){var i,s=a[t.type],o=e[t.bodyA],r=e[t.bodyB];switch(t.type){case"LockConstraint":i=new a.LockConstraint(o,r,t);break;case"DistanceConstraint":i=new a.DistanceConstraint(o,r,t.distance,t.maxForce);break;case"HingeConstraint":case"ConeTwistConstraint":i=new s(o,r,{pivotA:c(t.pivotA),pivotB:c(t.pivotB),axisA:c(t.axisA),axisB:c(t.axisB),maxForce:t.maxForce});break;case"PointToPointConstraint":i=new a.PointToPointConstraint(o,c(t.pivotA),r,c(t.pivotB),t.maxForce);break;default:throw new Error("Unexpected constraint type: "+t.type)}return i[n]=t.id,i},t.exports.serializeContact=function(t){return{bi:t.bi[n],bj:t.bj[n],ni:p(t.ni),ri:p(t.ri),rj:p(t.rj)}},t.exports.deserializeContact=function(t,e){return{bi:e[t.bi],bj:e[t.bj],ni:c(t.ni),ri:c(t.ri),rj:c(t.rj)}},t.exports.serializeVec3=p,t.exports.deserializeVec3=c,t.exports.serializeQuaternion=d,t.exports.deserializeQuaternion=u}}]);