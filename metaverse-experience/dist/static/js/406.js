"use strict";(self.webpackChunkmetaverse_experience=self.webpackChunkmetaverse_experience||[]).push([[406],{5406:function(e,t){const n=t.TYPE={BOX:"box",CYLINDER:"cylinder",SPHERE:"sphere",CAPSULE:"capsule",CONE:"cone",HULL:"hull",HACD:"hacd",VHACD:"vhacd",MESH:"mesh",HEIGHTFIELD:"heightfield"},r=t.FIT={ALL:"all",MANUAL:"manual"},o=(t.HEIGHTFIELD_DATA_TYPE={short:"short",float:"float"},THREE.Object3D.prototype.hasOwnProperty("updateMatrices"));function a(e){e.fit=e.hasOwnProperty("fit")?e.fit:r.ALL,e.type=e.type||n.HULL,e.minHalfExtent=e.hasOwnProperty("minHalfExtent")?e.minHalfExtent:0,e.maxHalfExtent=e.hasOwnProperty("maxHalfExtent")?e.maxHalfExtent:Number.POSITIVE_INFINITY,e.cylinderAxis=e.cylinderAxis||"y",e.margin=e.hasOwnProperty("margin")?e.margin:.01,e.includeInvisible=!!e.hasOwnProperty("includeInvisible")&&e.includeInvisible,e.offset||(e.offset=new THREE.Vector3),e.orientation||(e.orientation=new THREE.Quaternion)}t.createCollisionShapes=function(e,t){switch(t.type){case n.BOX:return[this.createBoxShape(e,t)];case n.CYLINDER:return[this.createCylinderShape(e,t)];case n.CAPSULE:return[this.createCapsuleShape(e,t)];case n.CONE:return[this.createConeShape(e,t)];case n.SPHERE:return[this.createSphereShape(e,t)];case n.HULL:return[this.createHullShape(e,t)];case n.HACD:return this.createHACDShapes(e,t);case n.VHACD:return this.createVHACDShapes(e,t);case n.MESH:return[this.createTriMeshShape(e,t)];case n.HEIGHTFIELD:return[this.createHeightfieldTerrainShape(e,t)];default:return console.warn(t.type+" is not currently supported"),[]}},t.createBoxShape=function(e,t){t.type=n.BOX,a(t),t.fit===r.ALL&&(t.halfExtents=c(e,u(e,t),t.minHalfExtent,t.maxHalfExtent));const o=new Ammo.btVector3(t.halfExtents.x,t.halfExtents.y,t.halfExtents.z),i=new Ammo.btBoxShape(o);return Ammo.destroy(o),s(i,t,m(e,t)),i},t.createCylinderShape=function(e,t){t.type=n.CYLINDER,a(t),t.fit===r.ALL&&(t.halfExtents=c(e,u(e,t),t.minHalfExtent,t.maxHalfExtent));const o=new Ammo.btVector3(t.halfExtents.x,t.halfExtents.y,t.halfExtents.z),i=(()=>{switch(t.cylinderAxis){case"y":return new Ammo.btCylinderShape(o);case"x":return new Ammo.btCylinderShapeX(o);case"z":return new Ammo.btCylinderShapeZ(o)}return null})();return Ammo.destroy(o),s(i,t,m(e,t)),i},t.createCapsuleShape=function(e,t){t.type=n.CAPSULE,a(t),t.fit===r.ALL&&(t.halfExtents=c(e,u(e,t),t.minHalfExtent,t.maxHalfExtent));const{x:o,y:i,z:l}=t.halfExtents,h=(()=>{switch(t.cylinderAxis){case"y":return new Ammo.btCapsuleShape(Math.max(o,l),2*i);case"x":return new Ammo.btCapsuleShapeX(Math.max(i,l),2*o);case"z":return new Ammo.btCapsuleShapeZ(Math.max(o,i),2*l)}return null})();return s(h,t,m(e,t)),h},t.createConeShape=function(e,t){t.type=n.CONE,a(t),t.fit===r.ALL&&(t.halfExtents=c(e,u(e,t),t.minHalfExtent,t.maxHalfExtent));const{x:o,y:i,z:l}=t.halfExtents,h=(()=>{switch(t.cylinderAxis){case"y":return new Ammo.btConeShape(Math.max(o,l),2*i);case"x":return new Ammo.btConeShapeX(Math.max(i,l),2*o);case"z":return new Ammo.btConeShapeZ(Math.max(o,i),2*l)}return null})();return s(h,t,m(e,t)),h},t.createSphereShape=function(e,t){let o;t.type=n.SPHERE,a(t),o=t.fit!==r.MANUAL||isNaN(t.sphereRadius)?l(e,t,u(e,t)):t.sphereRadius;const i=new Ammo.btSphereShape(o);return s(i,t,m(e,t)),i},t.createHullShape=function(){const e=new THREE.Vector3,t=new THREE.Vector3;return function(o,l){if(l.type=n.HULL,a(l),l.fit===r.MANUAL)return console.warn("cannot use fit: manual with type: hull"),null;const c=u(o,l),h=new Ammo.btVector3,p=new Ammo.btConvexHullShape;p.setMargin(l.margin),t.addVectors(c.max,c.min).multiplyScalar(.5);let y=0;i(o,l,(e=>{y+=e.attributes.position.array.length/3}));const A=l.hullMaxVertices||1e5;y>A&&console.warn(`too many vertices for hull shape; sampling ~${A} from ~${y} vertices`);const f=Math.min(1,A/y);i(o,l,((n,r)=>{const o=n.attributes.position.array;for(let n=0;n<o.length;n+=3)Math.random()<=f&&(e.set(o[n],o[n+1],o[n+2]).applyMatrix4(r).sub(t),h.setValue(e.x,e.y,e.z),p.addPoint(h,n===o.length-3))}));let x=p;if(p.getNumVertices()>=100){const e=new Ammo.btShapeHull(p);e.buildHull(l.margin),Ammo.destroy(p),x=new Ammo.btConvexHullShape(Ammo.getPointer(e.getVertexPointer()),e.numVertices()),Ammo.destroy(e)}return Ammo.destroy(h),s(x,l,m(o,l)),x}}(),t.createHACDShapes=function(){const e=new THREE.Vector3,t=new THREE.Vector3;return function(o,l){if(l.type=n.HACD,a(l),l.fit===r.MANUAL)return console.warn("cannot use fit: manual with type: hacd"),[];if(!Ammo.hasOwnProperty("HACD"))return console.warn("HACD unavailable in included build of Ammo.js. Visit https://github.com/mozillareality/ammo.js for the latest version."),[];const c=u(o),h=m(o,l);let p=0,y=0;t.addVectors(c.max,c.min).multiplyScalar(.5),i(o,l,(e=>{p+=e.attributes.position.array.length/3,e.index?y+=e.index.array.length/3:y+=e.attributes.position.array.length/9}));const A=new Ammo.HACD;l.hasOwnProperty("compacityWeight")&&A.SetCompacityWeight(l.compacityWeight),l.hasOwnProperty("volumeWeight")&&A.SetVolumeWeight(l.volumeWeight),l.hasOwnProperty("nClusters")&&A.SetNClusters(l.nClusters),l.hasOwnProperty("nVerticesPerCH")&&A.SetNVerticesPerCH(l.nVerticesPerCH),l.hasOwnProperty("concavity")&&A.SetConcavity(l.concavity);const f=Ammo._malloc(3*p*8),x=Ammo._malloc(3*y*4);A.SetPoints(f),A.SetTriangles(x),A.SetNPoints(p),A.SetNTriangles(y);const E=f/8,w=x/4;i(o,l,((n,r)=>{const o=n.attributes.position.array,a=n.index?n.index.array:null;for(let n=0;n<o.length;n+=3)e.set(o[n+0],o[n+1],o[n+2]).applyMatrix4(r).sub(t),Ammo.HEAPF64[E+n+0]=e.x,Ammo.HEAPF64[E+n+1]=e.y,Ammo.HEAPF64[E+n+2]=e.z;if(a)for(let e=0;e<a.length;e++)Ammo.HEAP32[w+e]=a[e];else for(let e=0;e<o.length/3;e++)Ammo.HEAP32[w+e]=e})),A.Compute(),Ammo._free(f),Ammo._free(x);const H=A.GetNClusters(),d=[];for(let e=0;e<H;e++){const t=new Ammo.btConvexHullShape;t.setMargin(l.margin);const n=A.GetNPointsCH(e),r=A.GetNTrianglesCH(e),o=Ammo._malloc(3*n*8),a=Ammo._malloc(3*r*4);A.GetCH(e,o,a);const i=o/8;for(let e=0;e<n;e++){const r=new Ammo.btVector3,o=Ammo.HEAPF64[i+3*e+0],a=Ammo.HEAPF64[i+3*e+1],s=Ammo.HEAPF64[i+3*e+2];r.setValue(o,a,s),t.addPoint(r,e===n-1),Ammo.destroy(r)}s(t,l,h),d.push(t)}return d}}(),t.createVHACDShapes=function(){const e=new THREE.Vector3,t=new THREE.Vector3;return function(o,l){if(l.type=n.VHACD,a(l),l.fit===r.MANUAL)return console.warn("cannot use fit: manual with type: vhacd"),[];if(!Ammo.hasOwnProperty("VHACD"))return console.warn("VHACD unavailable in included build of Ammo.js. Visit https://github.com/mozillareality/ammo.js for the latest version."),[];const c=u(o,l),h=m(o,l);let p=0,y=0;t.addVectors(c.max,c.min).multiplyScalar(.5),i(o,l,(e=>{p+=e.attributes.position.count,e.index?y+=e.index.count/3:y+=e.attributes.position.count/3}));const A=new Ammo.VHACD,f=new Ammo.Parameters;l.hasOwnProperty("resolution")&&f.set_m_resolution(l.resolution),l.hasOwnProperty("depth")&&f.set_m_depth(l.depth),l.hasOwnProperty("concavity")&&f.set_m_concavity(l.concavity),l.hasOwnProperty("planeDownsampling")&&f.set_m_planeDownsampling(l.planeDownsampling),l.hasOwnProperty("convexhullDownsampling")&&f.set_m_convexhullDownsampling(l.convexhullDownsampling),l.hasOwnProperty("alpha")&&f.set_m_alpha(l.alpha),l.hasOwnProperty("beta")&&f.set_m_beta(l.beta),l.hasOwnProperty("gamma")&&f.set_m_gamma(l.gamma),l.hasOwnProperty("pca")&&f.set_m_pca(l.pca),l.hasOwnProperty("mode")&&f.set_m_mode(l.mode),l.hasOwnProperty("maxNumVerticesPerCH")&&f.set_m_maxNumVerticesPerCH(l.maxNumVerticesPerCH),l.hasOwnProperty("minVolumePerCH")&&f.set_m_minVolumePerCH(l.minVolumePerCH),l.hasOwnProperty("convexhullApproximation")&&f.set_m_convexhullApproximation(l.convexhullApproximation),l.hasOwnProperty("oclAcceleration")&&f.set_m_oclAcceleration(l.oclAcceleration);const x=Ammo._malloc(3*p*8),E=Ammo._malloc(3*y*4);let w=x/8,H=E/4;i(o,l,((n,r)=>{const o=n.attributes.position.array,a=n.index?n.index.array:null;for(let n=0;n<o.length;n+=3)e.set(o[n+0],o[n+1],o[n+2]).applyMatrix4(r).sub(t),Ammo.HEAPF64[w+0]=e.x,Ammo.HEAPF64[w+1]=e.y,Ammo.HEAPF64[w+2]=e.z,w+=3;if(a)for(let e=0;e<a.length;e++)Ammo.HEAP32[H]=a[e],H++;else for(let e=0;e<o.length/3;e++)Ammo.HEAP32[H]=e,H++})),A.Compute(x,3,p,E,3,y,f),Ammo._free(x),Ammo._free(E);const d=A.GetNConvexHulls(),g=[],S=new Ammo.ConvexHull;for(let e=0;e<d;e++){A.GetConvexHull(e,S);const t=S.get_m_nPoints(),n=(S.get_m_points(),new Ammo.btConvexHullShape);n.setMargin(l.margin);for(let e=0;e<t;e++){const r=new Ammo.btVector3,o=S.get_m_points(3*e+0),a=S.get_m_points(3*e+1),s=S.get_m_points(3*e+2);r.setValue(o,a,s),n.addPoint(r,e===t-1),Ammo.destroy(r)}s(n,l,h),g.push(n)}return Ammo.destroy(S),Ammo.destroy(A),g}}(),t.createTriMeshShape=function(){const e=new THREE.Vector3,t=new THREE.Vector3,o=new THREE.Vector3;return function(l,c){if(c.type=n.MESH,a(c),c.fit===r.MANUAL)return console.warn("cannot use fit: manual with type: mesh"),null;const u=m(l,c),h=new Ammo.btVector3,p=new Ammo.btVector3,y=new Ammo.btVector3,A=new Ammo.btTriangleMesh(!0,!1);i(l,c,((n,r)=>{const a=n.attributes.position.array;if(n.index)for(let s=0;s<n.index.count;s+=3){const i=3*n.index.array[s],m=3*n.index.array[s+1],l=3*n.index.array[s+2];e.set(a[i],a[i+1],a[i+2]).applyMatrix4(r),t.set(a[m],a[m+1],a[m+2]).applyMatrix4(r),o.set(a[l],a[l+1],a[l+2]).applyMatrix4(r),h.setValue(e.x,e.y,e.z),p.setValue(t.x,t.y,t.z),y.setValue(o.x,o.y,o.z),A.addTriangle(h,p,y,!1)}else for(let n=0;n<a.length;n+=9)e.set(a[n+0],a[n+1],a[n+2]).applyMatrix4(r),t.set(a[n+3],a[n+4],a[n+5]).applyMatrix4(r),o.set(a[n+6],a[n+7],a[n+8]).applyMatrix4(r),h.setValue(e.x,e.y,e.z),p.setValue(t.x,t.y,t.z),y.setValue(o.x,o.y,o.z),A.addTriangle(h,p,y,!1)}));const f=new Ammo.btVector3(u.x,u.y,u.z);A.setScaling(f),Ammo.destroy(f);const x=new Ammo.btBvhTriangleMeshShape(A,!0,!0);return x.resources=[A],Ammo.destroy(h),Ammo.destroy(p),Ammo.destroy(y),s(x,c),x}}(),t.createHeightfieldTerrainShape=function(e,t){if(a(t),t.fit===r.ALL)return console.warn("cannot use fit: all with type: heightfield"),null;const n=t.heightfieldDistance||1,o=t.heightfieldData||[],i=t.heightScale||0,m=t.hasOwnProperty("upAxis")?t.upAxis:1,l="short"===t.heightDataType?Ammo.PHY_SHORT:Ammo.PHY_FLOAT,c=!t.hasOwnProperty("flipQuadEdges")||t.flipQuadEdges,u=o.length,h=u>0?o[0].length:0,p=Ammo._malloc(u*h*4),y=p/4;let A=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,x=0;for(let e=0;e<u;e++)for(let t=0;t<h;t++){const n=o[e][t];Ammo.HEAPF32[y+x]=n,x++,A=Math.min(A,n),f=Math.max(f,n)}const E=new Ammo.btHeightfieldTerrainShape(h,u,p,i,A,f,m,l,c),w=new Ammo.btVector3(n,1,n);return E.setLocalScaling(w),Ammo.destroy(w),E.heightfieldData=p,s(E,t),E};const s=function(e,t,n){e.type=t.type,e.setMargin(t.margin),e.destroy=()=>{for(let t of e.resources||[])Ammo.destroy(t);e.heightfieldData&&Ammo._free(e.heightfieldData),Ammo.destroy(e)};const r=new Ammo.btTransform,o=new Ammo.btQuaternion;if(r.setIdentity(),r.getOrigin().setValue(t.offset.x,t.offset.y,t.offset.z),o.setValue(t.orientation.x,t.orientation.y,t.orientation.z,t.orientation.w),r.setRotation(o),Ammo.destroy(o),n){const t=new Ammo.btVector3(n.x,n.y,n.z);e.setLocalScaling(t),Ammo.destroy(t)}e.localTransform=r},i=function(){const e=new THREE.Matrix4,t=new THREE.Matrix4,n=new THREE.BufferGeometry;return function(r,a,s){t.getInverse(r.matrixWorld),r.traverse((i=>{!i.isMesh||THREE.Sky&&i.__proto__==THREE.Sky.prototype||!(a.includeInvisible||i.el&&i.el.object3D.visible||i.visible)||(i===r?e.identity():(o&&i.updateMatrices(),e.multiplyMatrices(t,i.matrixWorld)),s(i.geometry.isBufferGeometry?i.geometry:n.fromGeometry(i.geometry),e))}))}}(),m=function(e,t){const n=new THREE.Vector3(1,1,1);return t.fit===r.ALL&&n.setFromMatrixScale(e.matrixWorld),n},l=function(){const e=new THREE.Vector3,t=new THREE.Vector3;return function(n,r,o){let a=0,{x:s,y:m,z:l}=o.getCenter(t);return i(n,r,((t,n)=>{const r=t.attributes.position.array;for(let t=0;t<r.length;t+=3){e.set(r[t],r[t+1],r[t+2]).applyMatrix4(n);const o=s-e.x,i=m-e.y,c=l-e.z;a=Math.max(a,o*o+i*i+c*c)}})),Math.sqrt(a)}}(),c=function(e,t,n,r){return(new THREE.Vector3).subVectors(t.max,t.min).multiplyScalar(.5).clampScalar(n,r)},u=function(){const e=new THREE.Vector3;return function(t,n){const r=new THREE.Box3;let o=1/0,a=1/0,s=1/0,m=-1/0,l=-1/0,c=-1/0;return r.min.set(0,0,0),r.max.set(0,0,0),i(t,n,((t,n)=>{const r=t.attributes.position.array;for(let t=0;t<r.length;t+=3)e.set(r[t],r[t+1],r[t+2]).applyMatrix4(n),e.x<o&&(o=e.x),e.y<a&&(a=e.y),e.z<s&&(s=e.z),e.x>m&&(m=e.x),e.y>l&&(l=e.y),e.z>c&&(c=e.z)})),r.min.set(o,a,s),r.max.set(m,l,c),r}}()}}]);