(self.webpackChunkmetaverse_experience=self.webpackChunkmetaverse_experience||[]).push([[227],{2182:function(e,t,i){i(3687);var r=i(1389),n=r.GRAVITY,o=r.CONTACT_MATERIAL,s=i(598),a=i(7810),u=i(8254),l=i(6203);e.exports=AFRAME.registerSystem("physics",{schema:{driver:{default:"local",oneOf:["local","worker","network","ammo"]},networkUrl:{default:"",if:{driver:"network"}},workerFps:{default:60,if:{driver:"worker"}},workerInterpolate:{default:!0,if:{driver:"worker"}},workerInterpBufferSize:{default:2,if:{driver:"worker"}},workerEngine:{default:"cannon",if:{driver:"worker"},oneOf:["cannon"]},workerDebug:{default:!1,if:{driver:"worker"}},gravity:{default:n},iterations:{default:r.ITERATIONS},friction:{default:o.friction},restitution:{default:o.restitution},contactEquationStiffness:{default:o.contactEquationStiffness},contactEquationRelaxation:{default:o.contactEquationRelaxation},frictionEquationStiffness:{default:o.frictionEquationStiffness},frictionEquationRegularization:{default:o.frictionEquationRegularization},maxInterval:{default:4/60},debug:{default:!1},debugDrawMode:{default:THREE.AmmoDebugConstants.NoDebug},maxSubSteps:{default:4},fixedTimeStep:{default:1/60}},async init(){var e=this.data;switch(this.debug=e.debug,this.callbacks={beforeStep:[],step:[],afterStep:[]},this.listeners={},this.driver=null,e.driver){case"local":this.driver=new s;break;case"ammo":this.driver=new l;break;case"network":this.driver=new u(e.networkUrl);break;case"worker":this.driver=new a({fps:e.workerFps,engine:e.workerEngine,interpolate:e.workerInterpolate,interpolationBufferSize:e.workerInterpBufferSize,debug:e.workerDebug});break;default:throw new Error('[physics] Driver not recognized: "%s".',e.driver)}"ammo"!==e.driver?(await this.driver.init({quatNormalizeSkip:0,quatNormalizeFast:!1,solverIterations:e.iterations,gravity:e.gravity}),this.driver.addMaterial({name:"defaultMaterial"}),this.driver.addMaterial({name:"staticMaterial"}),this.driver.addContactMaterial("defaultMaterial","defaultMaterial",{friction:e.friction,restitution:e.restitution,contactEquationStiffness:e.contactEquationStiffness,contactEquationRelaxation:e.contactEquationRelaxation,frictionEquationStiffness:e.frictionEquationStiffness,frictionEquationRegularization:e.frictionEquationRegularization}),this.driver.addContactMaterial("staticMaterial","defaultMaterial",{friction:1,restitution:0,contactEquationStiffness:e.contactEquationStiffness,contactEquationRelaxation:e.contactEquationRelaxation,frictionEquationStiffness:e.frictionEquationStiffness,frictionEquationRegularization:e.frictionEquationRegularization})):await this.driver.init({gravity:e.gravity,debugDrawMode:e.debugDrawMode,solverIterations:e.iterations,maxSubSteps:e.maxSubSteps,fixedTimeStep:e.fixedTimeStep}),this.initialized=!0,this.debug&&this.setDebug(!0)},tick:function(e,t){if(this.initialized&&t){var i,r=this.callbacks;for(i=0;i<this.callbacks.beforeStep.length;i++)this.callbacks.beforeStep[i].beforeStep(e,t);for(this.driver.step(Math.min(t/1e3,this.data.maxInterval)),i=0;i<r.step.length;i++)r.step[i].step(e,t);for(i=0;i<r.afterStep.length;i++)r.afterStep[i].afterStep(e,t)}},setDebug:function(e){this.debug=e,"ammo"===this.data.driver&&this.initialized&&(e&&!this.debugDrawer?(this.debugDrawer=this.driver.getDebugDrawer(this.el.object3D),this.debugDrawer.enable()):this.debugDrawer&&(this.debugDrawer.disable(),this.debugDrawer=null))},addBody:function(e,t,i){var r=this.driver;"local"===this.data.driver&&(e.__applyImpulse=e.applyImpulse,e.applyImpulse=function(){r.applyBodyMethod(e,"applyImpulse",arguments)},e.__applyForce=e.applyForce,e.applyForce=function(){r.applyBodyMethod(e,"applyForce",arguments)},e.updateProperties=function(){r.updateBodyProperties(e)},this.listeners[e.id]=function(t){e.el.emit("collide",t)},e.addEventListener("collide",this.listeners[e.id])),this.driver.addBody(e,t,i)},removeBody:function(e){this.driver.removeBody(e),"local"!==this.data.driver&&"worker"!==this.data.driver||(e.removeEventListener("collide",this.listeners[e.id]),delete this.listeners[e.id],e.applyImpulse=e.__applyImpulse,delete e.__applyImpulse,e.applyForce=e.__applyForce,delete e.__applyForce,delete e.updateProperties)},addConstraint:function(e){this.driver.addConstraint(e)},removeConstraint:function(e){this.driver.removeConstraint(e)},addComponent:function(e){var t=this.callbacks;e.beforeStep&&t.beforeStep.push(e),e.step&&t.step.push(e),e.afterStep&&t.afterStep.push(e)},removeComponent:function(e){var t=this.callbacks;e.beforeStep&&t.beforeStep.splice(t.beforeStep.indexOf(e),1),e.step&&t.step.splice(t.step.indexOf(e),1),e.afterStep&&t.afterStep.splice(t.afterStep.indexOf(e),1)},getContacts:function(){return this.driver.getContacts()},getMaterial:function(e){return this.driver.getMaterial(e)}})},7558:function(e){e.exports.slerp=function(e,t,i){if(i<=0)return e;if(i>=1)return t;var r=e[0],n=e[1],o=e[2],s=e[3],a=s*t[3]+r*t[0]+n*t[1]+o*t[2];if(!(a<0))return t;if((e=e.slice())[3]=-t[3],e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],(a=-a)>=1)return e[3]=s,e[0]=r,e[1]=n,e[2]=o,this;var u=Math.sqrt(1-a*a);if(Math.abs(u)<.001)return e[3]=.5*(s+e[3]),e[0]=.5*(r+e[0]),e[1]=.5*(n+e[1]),e[2]=.5*(o+e[2]),this;var l=Math.atan2(u,a),c=Math.sin((1-i)*l)/u,h=Math.sin(i*l)/u;return e[3]=s*c+e[3]*h,e[0]=r*c+e[0]*h,e[1]=n*c+e[1]*h,e[2]=o*c+e[2]*h,e}},779:function(e,t,i){var r=i(3687),n=i(7558),o="__id";e.exports.ID=o;var s={};function a(e){var t={type:e.type};if(e.type===r.Shape.types.BOX)t.halfExtents=l(e.halfExtents);else if(e.type===r.Shape.types.SPHERE)t.radius=e.radius;else{if(e._type!==r.Shape.types.CYLINDER)throw new Error("Unimplemented shape type: %s",e.type);t.type=r.Shape.types.CYLINDER,t.radiusTop=e.radiusTop,t.radiusBottom=e.radiusBottom,t.height=e.height,t.numSegments=e.numSegments}return t}function u(e){var t;if(e.type===r.Shape.types.BOX)t=new r.Box(c(e.halfExtents));else if(e.type===r.Shape.types.SPHERE)t=new r.Sphere(e.radius);else{if(e.type!==r.Shape.types.CYLINDER)throw new Error("Unimplemented shape type: %s",e.type);(t=new r.Cylinder(e.radiusTop,e.radiusBottom,e.height,e.numSegments))._type=r.Shape.types.CYLINDER}return t}function l(e){return e.toArray()}function c(e){return new r.Vec3(e[0],e[1],e[2])}function h(e){return e.toArray()}function p(e){return new r.Quaternion(e[0],e[1],e[2],e[3])}e.exports.assignID=function(e,t){t[o]||(s[e]=s[e]||1,t[o]=e+"_"+s[e]++)},e.exports.serializeBody=function(e){return{shapes:e.shapes.map(a),shapeOffsets:e.shapeOffsets.map(l),shapeOrientations:e.shapeOrientations.map(h),position:l(e.position),quaternion:e.quaternion.toArray(),velocity:l(e.velocity),angularVelocity:l(e.angularVelocity),id:e[o],mass:e.mass,linearDamping:e.linearDamping,angularDamping:e.angularDamping,fixedRotation:e.fixedRotation,allowSleep:e.allowSleep,sleepSpeedLimit:e.sleepSpeedLimit,sleepTimeLimit:e.sleepTimeLimit}},e.exports.deserializeBodyUpdate=function(e,t){return t.position.set(e.position[0],e.position[1],e.position[2]),t.quaternion.set(e.quaternion[0],e.quaternion[1],e.quaternion[2],e.quaternion[3]),t.velocity.set(e.velocity[0],e.velocity[1],e.velocity[2]),t.angularVelocity.set(e.angularVelocity[0],e.angularVelocity[1],e.angularVelocity[2]),t.linearDamping=e.linearDamping,t.angularDamping=e.angularDamping,t.fixedRotation=e.fixedRotation,t.allowSleep=e.allowSleep,t.sleepSpeedLimit=e.sleepSpeedLimit,t.sleepTimeLimit=e.sleepTimeLimit,t.mass!==e.mass&&(t.mass=e.mass,t.updateMassProperties()),t},e.exports.deserializeInterpBodyUpdate=function(e,t,i,r){var o=1-r,s=r;i.position.set(e.position[0]*o+t.position[0]*s,e.position[1]*o+t.position[1]*s,e.position[2]*o+t.position[2]*s);var a=n.slerp(e.quaternion,t.quaternion,r);return i.quaternion.set(a[0],a[1],a[2],a[3]),i.velocity.set(e.velocity[0]*o+t.velocity[0]*s,e.velocity[1]*o+t.velocity[1]*s,e.velocity[2]*o+t.velocity[2]*s),i.angularVelocity.set(e.angularVelocity[0]*o+t.angularVelocity[0]*s,e.angularVelocity[1]*o+t.angularVelocity[1]*s,e.angularVelocity[2]*o+t.angularVelocity[2]*s),i.linearDamping=t.linearDamping,i.angularDamping=t.angularDamping,i.fixedRotation=t.fixedRotation,i.allowSleep=t.allowSleep,i.sleepSpeedLimit=t.sleepSpeedLimit,i.sleepTimeLimit=t.sleepTimeLimit,i.mass!==t.mass&&(i.mass=t.mass,i.updateMassProperties()),i},e.exports.deserializeBody=function(e){for(var t,i=new r.Body({mass:e.mass,position:c(e.position),quaternion:p(e.quaternion),velocity:c(e.velocity),angularVelocity:c(e.angularVelocity),linearDamping:e.linearDamping,angularDamping:e.angularDamping,fixedRotation:e.fixedRotation,allowSleep:e.allowSleep,sleepSpeedLimit:e.sleepSpeedLimit,sleepTimeLimit:e.sleepTimeLimit}),n=0;t=e.shapes[n];n++)i.addShape(u(t),c(e.shapeOffsets[n]),p(e.shapeOrientations[n]));return i[o]=e.id,i},e.exports.serializeShape=a,e.exports.deserializeShape=u,e.exports.serializeConstraint=function(e){var t={id:e[o],type:e.type,maxForce:e.maxForce,bodyA:e.bodyA[o],bodyB:e.bodyB[o]};switch(e.type){case"LockConstraint":break;case"DistanceConstraint":t.distance=e.distance;break;case"HingeConstraint":case"ConeTwistConstraint":t.axisA=l(e.axisA),t.axisB=l(e.axisB),t.pivotA=l(e.pivotA),t.pivotB=l(e.pivotB);break;case"PointToPointConstraint":t.pivotA=l(e.pivotA),t.pivotB=l(e.pivotB);break;default:throw new Error("Unexpected constraint type: "+e.type+'. You may need to manually set `constraint.type = "FooConstraint";`.')}return t},e.exports.deserializeConstraint=function(e,t){var i,n=r[e.type],s=t[e.bodyA],a=t[e.bodyB];switch(e.type){case"LockConstraint":i=new r.LockConstraint(s,a,e);break;case"DistanceConstraint":i=new r.DistanceConstraint(s,a,e.distance,e.maxForce);break;case"HingeConstraint":case"ConeTwistConstraint":i=new n(s,a,{pivotA:c(e.pivotA),pivotB:c(e.pivotB),axisA:c(e.axisA),axisB:c(e.axisB),maxForce:e.maxForce});break;case"PointToPointConstraint":i=new r.PointToPointConstraint(s,c(e.pivotA),a,c(e.pivotB),e.maxForce);break;default:throw new Error("Unexpected constraint type: "+e.type)}return i[o]=e.id,i},e.exports.serializeContact=function(e){return{bi:e.bi[o],bj:e.bj[o],ni:l(e.ni),ri:l(e.ri),rj:l(e.rj)}},e.exports.deserializeContact=function(e,t){return{bi:t[e.bi],bj:t[e.bj],ni:c(e.ni),ri:c(e.ri),rj:c(e.rj)}},e.exports.serializeVec3=l,e.exports.deserializeVec3=c,e.exports.serializeQuaternion=h,e.exports.deserializeQuaternion=p},2694:function(){THREE.AmmoDebugConstants={NoDebug:0,DrawWireframe:1,DrawAabb:2,DrawFeaturesText:4,DrawContactPoints:8,NoDeactivation:16,NoHelpText:32,DrawText:64,ProfileTimings:128,EnableSatComparison:256,DisableBulletLCP:512,EnableCCD:1024,DrawConstraints:2048,DrawConstraintLimits:4096,FastWireframe:8192,DrawNormals:16384,DrawOnTop:32768,MAX_DEBUG_DRAW_MODE:4294967295},THREE.AmmoDebugDrawer=function(e,t,i){this.scene=e,this.world=t,i=i||{},this.debugDrawMode=i.debugDrawMode||THREE.AmmoDebugConstants.DrawWireframe;var r=this.debugDrawMode&THREE.AmmoDebugConstants.DrawOnTop||!1,n=i.maxBufferSize||1e6;this.geometry=new THREE.BufferGeometry;var o=new Float32Array(3*n),s=new Float32Array(3*n);this.geometry.addAttribute("position",new THREE.BufferAttribute(o,3).setDynamic(!0)),this.geometry.addAttribute("color",new THREE.BufferAttribute(s,3).setDynamic(!0)),this.index=0;var a=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,depthTest:!r});this.mesh=new THREE.LineSegments(this.geometry,a),r&&(this.mesh.renderOrder=999),this.mesh.frustumCulled=!1,this.enabled=!1,this.debugDrawer=new Ammo.DebugDrawer,this.debugDrawer.drawLine=this.drawLine.bind(this),this.debugDrawer.drawContactPoint=this.drawContactPoint.bind(this),this.debugDrawer.reportErrorWarning=this.reportErrorWarning.bind(this),this.debugDrawer.draw3dText=this.draw3dText.bind(this),this.debugDrawer.setDebugMode=this.setDebugMode.bind(this),this.debugDrawer.getDebugMode=this.getDebugMode.bind(this),this.debugDrawer.enable=this.enable.bind(this),this.debugDrawer.disable=this.disable.bind(this),this.debugDrawer.update=this.update.bind(this),this.world.setDebugDrawer(this.debugDrawer)},THREE.AmmoDebugDrawer.prototype=function(){return this.debugDrawer},THREE.AmmoDebugDrawer.prototype.enable=function(){this.enabled=!0,this.scene.add(this.mesh)},THREE.AmmoDebugDrawer.prototype.disable=function(){this.enabled=!1,this.scene.remove(this.mesh)},THREE.AmmoDebugDrawer.prototype.update=function(){this.enabled&&(0!=this.index&&(this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.color.needsUpdate=!0),this.index=0,this.world.debugDrawWorld(),this.geometry.setDrawRange(0,this.index))},THREE.AmmoDebugDrawer.prototype.drawLine=function(e,t,i){const r=Ammo.HEAPF32,n=r[(i+0)/4],o=r[(i+4)/4],s=r[(i+8)/4],a=r[(e+0)/4],u=r[(e+4)/4],l=r[(e+8)/4];this.geometry.attributes.position.setXYZ(this.index,a,u,l),this.geometry.attributes.color.setXYZ(this.index++,n,o,s);const c=r[(t+0)/4],h=r[(t+4)/4],p=r[(t+8)/4];this.geometry.attributes.position.setXYZ(this.index,c,h,p),this.geometry.attributes.color.setXYZ(this.index++,n,o,s)},THREE.AmmoDebugDrawer.prototype.drawContactPoint=function(e,t,i,r,n){const o=Ammo.HEAPF32,s=o[(n+0)/4],a=o[(n+4)/4],u=o[(n+8)/4],l=o[(e+0)/4],c=o[(e+4)/4],h=o[(e+8)/4];this.geometry.attributes.position.setXYZ(this.index,l,c,h),this.geometry.attributes.color.setXYZ(this.index++,s,a,u);const p=o[(t+0)/4]*i,d=o[(t+4)/4]*i,f=o[(t+8)/4]*i;this.geometry.attributes.position.setXYZ(this.index,l+p,c+d,h+f),this.geometry.attributes.color.setXYZ(this.index++,s,a,u)},THREE.AmmoDebugDrawer.prototype.reportErrorWarning=function(e){Ammo.hasOwnProperty("Pointer_stringify")?console.warn(Ammo.Pointer_stringify(e)):this.warnedOnce||(this.warnedOnce=!0,console.warn("Cannot print warningString, please rebuild Ammo.js using 'debug' flag"))},THREE.AmmoDebugDrawer.prototype.draw3dText=function(e,t){console.warn("TODO: draw3dText")},THREE.AmmoDebugDrawer.prototype.setDebugMode=function(e){this.debugDrawMode=e},THREE.AmmoDebugDrawer.prototype.getDebugMode=function(){return this.debugDrawMode}},6594:function(e,t,i){"use strict";i.r(t),i.d(t,{Pathfinding:function(){return a},PathfindingHelper:function(){return l}});var r=i(9477);class n{static roundNumber(e,t){const i=Math.pow(10,t);return Math.round(e*i)/i}static sample(e){return e[Math.floor(Math.random()*e.length)]}static distanceToSquared(e,t){var i=e.x-t.x,r=e.y-t.y,n=e.z-t.z;return i*i+r*r+n*n}static isPointInPoly(e,t){for(var i=!1,r=-1,n=e.length,o=n-1;++r<n;o=r)(e[r].z<=t.z&&t.z<e[o].z||e[o].z<=t.z&&t.z<e[r].z)&&t.x<(e[o].x-e[r].x)*(t.z-e[r].z)/(e[o].z-e[r].z)+e[r].x&&(i=!i);return i}static isVectorInPolygon(e,t,i){var r=1e5,n=-1e5,o=[];return t.vertexIds.forEach((e=>{r=Math.min(i[e].y,r),n=Math.max(i[e].y,n),o.push(i[e])})),!!(e.y<n+.5&&e.y>r-.5&&this.isPointInPoly(o,e))}static triarea2(e,t,i){return(i.x-e.x)*(t.z-e.z)-(t.x-e.x)*(i.z-e.z)}static vequal(e,t){return this.distanceToSquared(e,t)<1e-5}static mergeVertices(e,t=1e-4){t=Math.max(t,Number.EPSILON);for(var i={},n=e.getIndex(),o=e.getAttribute("position"),s=n?n.count:o.count,a=0,u=[],l=[],c=Math.log10(1/t),h=Math.pow(10,c),p=0;p<s;p++){var d=n?n.getX(p):p,f="";f+=~~(o.getX(d)*h)+",",f+=~~(o.getY(d)*h)+",",(f+=~~(o.getZ(d)*h)+",")in i?u.push(i[f]):(l.push(o.getX(d)),l.push(o.getY(d)),l.push(o.getZ(d)),i[f]=a,u.push(a),a++)}const g=new r.TlE(new Float32Array(l),o.itemSize,o.normalized),m=new r.u9r;return m.setAttribute("position",g),m.setIndex(u),m}}class o{constructor(e){this.content=[],this.scoreFunction=e}push(e){this.content.push(e),this.sinkDown(this.content.length-1)}pop(){const e=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content[0]=t,this.bubbleUp(0)),e}remove(e){const t=this.content.indexOf(e),i=this.content.pop();t!==this.content.length-1&&(this.content[t]=i,this.scoreFunction(i)<this.scoreFunction(e)?this.sinkDown(t):this.bubbleUp(t))}size(){return this.content.length}rescoreElement(e){this.sinkDown(this.content.indexOf(e))}sinkDown(e){const t=this.content[e];for(;e>0;){const i=(e+1>>1)-1,r=this.content[i];if(!(this.scoreFunction(t)<this.scoreFunction(r)))break;this.content[i]=t,this.content[e]=r,e=i}}bubbleUp(e){const t=this.content.length,i=this.content[e],r=this.scoreFunction(i);for(;;){const n=e+1<<1,o=n-1;let s,a=null;if(o<t&&(s=this.scoreFunction(this.content[o]),s<r&&(a=o)),n<t&&this.scoreFunction(this.content[n])<(null===a?r:s)&&(a=n),null===a)break;this.content[e]=this.content[a],this.content[a]=i,e=a}}}class s{constructor(){this.portals=[]}push(e,t){void 0===t&&(t=e),this.portals.push({left:e,right:t})}stringPull(){const e=this.portals,t=[];let i,r,o,s=0,a=0,u=0;i=e[0].left,r=e[0].left,o=e[0].right,t.push(i);for(let l=1;l<e.length;l++){const c=e[l].left,h=e[l].right;if(n.triarea2(i,o,h)<=0){if(!(n.vequal(i,o)||n.triarea2(i,r,h)>0)){t.push(r),i=r,s=a,r=i,o=i,a=s,u=s,l=s;continue}o=h,u=l}if(n.triarea2(i,r,c)>=0){if(!(n.vequal(i,r)||n.triarea2(i,o,c)<0)){t.push(o),i=o,s=u,r=i,o=i,a=s,u=s,l=s;continue}r=c,a=l}}return 0!==t.length&&n.vequal(t[t.length-1],e[e.length-1].left)||t.push(e[e.length-1].left),this.path=t,t}}class a{constructor(){this.zones={}}static createZone(e,t=1e-4){return class{static buildZone(e,t){const i=this._buildNavigationMesh(e,t),o={};i.vertices.forEach((e=>{e.x=n.roundNumber(e.x,2),e.y=n.roundNumber(e.y,2),e.z=n.roundNumber(e.z,2)})),o.vertices=i.vertices;const s=this._buildPolygonGroups(i);return o.groups=new Array(s.length),s.forEach(((e,t)=>{const i=new Map;e.forEach(((e,t)=>{i.set(e,t)}));const s=new Array(e.length);e.forEach(((e,t)=>{const a=[];e.neighbours.forEach((e=>a.push(i.get(e))));const u=[];e.neighbours.forEach((t=>u.push(this._getSharedVerticesInOrder(e,t))));const l=new r.Pa4(0,0,0);l.add(o.vertices[e.vertexIds[0]]),l.add(o.vertices[e.vertexIds[1]]),l.add(o.vertices[e.vertexIds[2]]),l.divideScalar(3),l.x=n.roundNumber(l.x,2),l.y=n.roundNumber(l.y,2),l.z=n.roundNumber(l.z,2),s[t]={id:t,neighbours:a,vertexIds:e.vertexIds,centroid:l,portals:u}})),o.groups[t]=s})),o}static _buildNavigationMesh(e,t){return e=n.mergeVertices(e,t),this._buildPolygonsFromGeometry(e)}static _spreadGroupId(e){let t=new Set([e]);for(;t.size>0;){const i=t;t=new Set,i.forEach((i=>{i.group=e.group,i.neighbours.forEach((e=>{void 0===e.group&&t.add(e)}))}))}}static _buildPolygonGroups(e){const t=[];return e.polygons.forEach((e=>{void 0!==e.group?t[e.group].push(e):(e.group=t.length,this._spreadGroupId(e),t.push([e]))})),t}static _buildPolygonNeighbours(e,t){const i=new Set,r=t[e.vertexIds[1]],n=t[e.vertexIds[2]];return t[e.vertexIds[0]].forEach((t=>{t!==e&&(r.includes(t)||n.includes(t))&&i.add(t)})),r.forEach((t=>{t!==e&&n.includes(t)&&i.add(t)})),i}static _buildPolygonsFromGeometry(e){const t=[],i=[],n=e.attributes.position,o=e.index,s=[];for(let e=0;e<n.count;e++)i.push((new r.Pa4).fromBufferAttribute(n,e)),s[e]=[];for(let i=0;i<e.index.count;i+=3){const e=o.getX(i),r=o.getX(i+1),n=o.getX(i+2),a={vertexIds:[e,r,n],neighbours:null};t.push(a),s[e].push(a),s[r].push(a),s[n].push(a)}return t.forEach((e=>{e.neighbours=this._buildPolygonNeighbours(e,s)})),{polygons:t,vertices:i}}static _getSharedVerticesInOrder(e,t){const i=e.vertexIds,r=i[0],n=i[1],o=i[2],s=t.vertexIds,a=s.includes(r),u=s.includes(n),l=s.includes(o);return a&&u&&l?Array.from(i):a&&u?[r,n]:u&&l?[n,o]:a&&l?[o,r]:(console.warn("Error processing navigation mesh neighbors; neighbors with <2 shared vertices found."),[])}}.buildZone(e,t)}setZoneData(e,t){this.zones[e]=t}getRandomNode(e,t,i,o){if(!this.zones[e])return new r.Pa4;i=i||null,o=o||0;const s=[];return this.zones[e].groups[t].forEach((e=>{i&&o?n.distanceToSquared(i,e.centroid)<o*o&&s.push(e.centroid):s.push(e.centroid)})),n.sample(s)||new r.Pa4}getClosestNode(e,t,i,r=!1){const o=this.zones[t].vertices;let s=null,a=1/0;return this.zones[t].groups[i].forEach((t=>{const i=n.distanceToSquared(t.centroid,e);i<a&&(!r||n.isVectorInPolygon(e,t,o))&&(s=t,a=i)})),s}findPath(e,t,i,a){const u=this.zones[i].groups[a],l=this.zones[i].vertices,c=this.getClosestNode(e,i,a,!0),h=this.getClosestNode(t,i,a,!0);if(!c||!h)return null;const p=class{static init(e){for(let t=0;t<e.length;t++){const i=e[t];i.f=0,i.g=0,i.h=0,i.cost=1,i.visited=!1,i.closed=!1,i.parent=null}}static cleanUp(e){for(let t=0;t<e.length;t++){const i=e[t];delete i.f,delete i.g,delete i.h,delete i.cost,delete i.visited,delete i.closed,delete i.parent}}static heap(){return new o((function(e){return e.f}))}static search(e,t,i){this.init(e);const r=this.heap();for(r.push(t);r.size()>0;){const t=r.pop();if(t===i){let e=t;const i=[];for(;e.parent;)i.push(e),e=e.parent;return this.cleanUp(i),i.reverse()}t.closed=!0;const n=this.neighbours(e,t);for(let e=0,o=n.length;e<o;e++){const o=n[e];if(o.closed)continue;const s=t.g+o.cost,a=o.visited;if(!a||s<o.g){if(o.visited=!0,o.parent=t,!o.centroid||!i.centroid)throw new Error("Unexpected state");o.h=o.h||this.heuristic(o.centroid,i.centroid),o.g=s,o.f=o.g+o.h,a?r.rescoreElement(o):r.push(o)}}}return[]}static heuristic(e,t){return n.distanceToSquared(e,t)}static neighbours(e,t){const i=[];for(let r=0;r<t.neighbours.length;r++)i.push(e[t.neighbours[r]]);return i}}.search(u,c,h),d=function(e,t){for(var i=0;i<e.neighbours.length;i++)if(e.neighbours[i]===t.id)return e.portals[i]},f=new s;f.push(e);for(let e=0;e<p.length;e++){const t=p[e],i=p[e+1];if(i){const e=d(t,i);f.push(l[e[0]],l[e[1]])}}f.push(t),f.stringPull();const g=f.path.map((e=>new r.Pa4(e.x,e.y,e.z)));return g.shift(),g}}a.prototype.getGroup=function(){const e=new r.JOQ;return function(t,i,r=!1){if(!this.zones[t])return null;let o=null,s=Math.pow(50,2);const a=this.zones[t];for(let t=0;t<a.groups.length;t++){const u=a.groups[t];for(const l of u){if(r&&(e.setFromCoplanarPoints(a.vertices[l.vertexIds[0]],a.vertices[l.vertexIds[1]],a.vertices[l.vertexIds[2]]),Math.abs(e.distanceToPoint(i))<.01)&&n.isPointInPoly([a.vertices[l.vertexIds[0]],a.vertices[l.vertexIds[1]],a.vertices[l.vertexIds[2]]],i))return t;const u=n.distanceToSquared(l.centroid,i);u<s&&(o=t,s=u)}}return o}}(),a.prototype.clampStep=function(){const e=new r.Pa4,t=new r.JOQ,i=new r.CJI,n=new r.Pa4;let o,s,a=new r.Pa4;return function(r,u,l,c,h,p){const d=this.zones[c].vertices,f=this.zones[c].groups[h],g=[l],m={};m[l.id]=0,o=void 0,a.set(0,0,0),s=1/0,t.setFromCoplanarPoints(d[l.vertexIds[0]],d[l.vertexIds[1]],d[l.vertexIds[2]]),t.projectPoint(u,e),n.copy(e);for(let t=g.pop();t;t=g.pop()){i.set(d[t.vertexIds[0]],d[t.vertexIds[1]],d[t.vertexIds[2]]),i.closestPointToPoint(n,e),e.distanceToSquared(n)<s&&(o=t,a.copy(e),s=e.distanceToSquared(n));const r=m[t.id];if(!(r>2))for(let e=0;e<t.neighbours.length;e++){const i=f[t.neighbours[e]];i.id in m||(g.push(i),m[i.id]=r+1)}}return p.copy(a),o}}();const u={PLAYER:new r.Ilk(15631215).convertSRGBToLinear().getHex(),TARGET:new r.Ilk(14469912).convertSRGBToLinear().getHex(),PATH:new r.Ilk(41903).convertSRGBToLinear().getHex(),WAYPOINT:new r.Ilk(41903).convertSRGBToLinear().getHex(),CLAMPED_STEP:new r.Ilk(14472114).convertSRGBToLinear().getHex(),CLOSEST_NODE:new r.Ilk(4417387).convertSRGBToLinear().getHex()};class l extends r.Tme{constructor(){super(),this._playerMarker=new r.Kj0(new r.xo$(.25,32,32),new r.vBJ({color:u.PLAYER})),this._targetMarker=new r.Kj0(new r.DvJ(.3,.3,.3),new r.vBJ({color:u.TARGET})),this._nodeMarker=new r.Kj0(new r.DvJ(.1,.8,.1),new r.vBJ({color:u.CLOSEST_NODE})),this._stepMarker=new r.Kj0(new r.DvJ(.1,1,.1),new r.vBJ({color:u.CLAMPED_STEP})),this._pathMarker=new r.Tme,this._pathLineMaterial=new r.nls({color:u.PATH,linewidth:2}),this._pathPointMaterial=new r.vBJ({color:u.WAYPOINT}),this._pathPointGeometry=new r.xo$(.08),this._markers=[this._playerMarker,this._targetMarker,this._nodeMarker,this._stepMarker,this._pathMarker],this._markers.forEach((e=>{e.visible=!1,this.add(e)}))}setPath(e){for(;this._pathMarker.children.length;)this._pathMarker.children[0].visible=!1,this._pathMarker.remove(this._pathMarker.children[0]);e=[this._playerMarker.position].concat(e);const t=new r.u9r;t.setAttribute("position",new r.TlE(new Float32Array(3*e.length),3));for(let i=0;i<e.length;i++)t.attributes.position.setXYZ(i,e[i].x,e[i].y+.2,e[i].z);this._pathMarker.add(new r.x12(t,this._pathLineMaterial));for(let t=0;t<e.length-1;t++){const i=new r.Kj0(this._pathPointGeometry,this._pathPointMaterial);i.position.copy(e[t]),i.position.y+=.2,this._pathMarker.add(i)}return this._pathMarker.visible=!0,this}setPlayerPosition(e){return this._playerMarker.position.copy(e),this._playerMarker.visible=!0,this}setTargetPosition(e){return this._targetMarker.position.copy(e),this._targetMarker.visible=!0,this}setNodePosition(e){return this._nodeMarker.position.copy(e),this._nodeMarker.visible=!0,this}setStepPosition(e){return this._stepMarker.position.copy(e),this._stepMarker.visible=!0,this}reset(){for(;this._pathMarker.children.length;)this._pathMarker.children[0].visible=!1,this._pathMarker.remove(this._pathMarker.children[0]);return this._markers.forEach((e=>{e.visible=!1})),this}}},8034:function(e){var t=arguments[3],i=arguments[4],r=arguments[5],n=JSON.stringify;e.exports=function(e,o){for(var s,a=Object.keys(r),u=0,l=a.length;u<l;u++){var c=a[u],h=r[c].exports;if(h===e||h&&h.default===e){s=c;break}}if(!s){s=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var p={};for(u=0,l=a.length;u<l;u++){p[c=a[u]]=c}i[s]=["function(require,module,exports){"+e+"(self); }",p]}var d=Math.floor(Math.pow(16,8)*Math.random()).toString(16),f={};f[s]=s,i[d]=["function(require,module,exports){var f = require("+n(s)+");(f.default ? f.default : f)(self);}",f];var g={};!function e(t){for(var r in g[t]=!0,i[t][1]){var n=i[t][1][r];g[n]||e(n)}}(d);var m="("+t+")({"+Object.keys(g).map((function(e){return n(e)+":["+i[e][0]+","+n(i[e][1])+"]"})).join(",")+"},{},["+n(d)+"])",b=window.URL||window.webkitURL||window.mozURL||window.msURL,w=new Blob([m],{type:"text/javascript"});if(o&&o.bare)return w;var v=b.createObjectURL(w),y=new Worker(v);return y.objectURL=v,y}}}]);