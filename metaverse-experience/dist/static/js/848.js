(self.webpackChunkmetaverse_experience=self.webpackChunkmetaverse_experience||[]).push([[848],{6203:function(t,e,o){const i=o(1778);"undefined"!=typeof window&&(window.AmmoModule=window.Ammo,window.Ammo=null);function s(){this.collisionConfiguration=null,this.dispatcher=null,this.broadphase=null,this.solver=null,this.physicsWorld=null,this.debugDrawer=null,this.els=new Map,this.eventListeners=[],this.collisions=new Map,this.collisionKeys=[],this.currentCollisions=new Map}s.prototype=new i,s.prototype.constructor=s,t.exports=s,s.prototype.init=function(t){return new Promise((e=>{AmmoModule().then((o=>{Ammo=o,this.epsilon=t.epsilon||1e-5,this.debugDrawMode=t.debugDrawMode||THREE.AmmoDebugConstants.NoDebug,this.maxSubSteps=t.maxSubSteps||4,this.fixedTimeStep=t.fixedTimeStep||1/60,this.collisionConfiguration=new Ammo.btDefaultCollisionConfiguration,this.dispatcher=new Ammo.btCollisionDispatcher(this.collisionConfiguration),this.broadphase=new Ammo.btDbvtBroadphase,this.solver=new Ammo.btSequentialImpulseConstraintSolver,this.physicsWorld=new Ammo.btDiscreteDynamicsWorld(this.dispatcher,this.broadphase,this.solver,this.collisionConfiguration),this.physicsWorld.setForceUpdateAllAabbs(!1),this.physicsWorld.setGravity(new Ammo.btVector3(0,t.hasOwnProperty("gravity")?t.gravity:-9.8,0)),this.physicsWorld.getSolverInfo().set_m_numIterations(t.solverIterations),e()}))}))},s.prototype.addBody=function(t,e,o){this.physicsWorld.addRigidBody(t,e,o),this.els.set(Ammo.getPointer(t),t.el)},s.prototype.removeBody=function(t){this.physicsWorld.removeRigidBody(t),this.removeEventListener(t);const e=Ammo.getPointer(t);this.els.delete(e),this.collisions.delete(e),this.collisionKeys.splice(this.collisionKeys.indexOf(e),1),this.currentCollisions.delete(e)},s.prototype.updateBody=function(t){this.els.has(Ammo.getPointer(t))&&this.physicsWorld.updateSingleAabb(t)},s.prototype.step=function(t){this.physicsWorld.stepSimulation(t,this.maxSubSteps,this.fixedTimeStep);const e=this.dispatcher.getNumManifolds();for(let t=0;t<e;t++){const e=this.dispatcher.getManifoldByIndexInternal(t),o=e.getNumContacts(),i=Ammo.getPointer(e.getBody0()),s=Ammo.getPointer(e.getBody1());let n=!1;for(let t=0;t<o;t++){if(e.getContactPoint(t).getDistance()<=this.epsilon){n=!0;break}}n&&(this.collisions.has(i)||(this.collisions.set(i,[]),this.collisionKeys.push(i)),-1===this.collisions.get(i).indexOf(s)&&(this.collisions.get(i).push(s),-1!==this.eventListeners.indexOf(i)&&this.els.get(i).emit("collidestart",{targetEl:this.els.get(s)}),-1!==this.eventListeners.indexOf(s)&&this.els.get(s).emit("collidestart",{targetEl:this.els.get(i)})),this.currentCollisions.has(i)||this.currentCollisions.set(i,new Set),this.currentCollisions.get(i).add(s))}for(let t=0;t<this.collisionKeys.length;t++){const e=this.collisionKeys[t],o=this.collisions.get(e);for(let t=o.length-1;t>=0;t--){const i=o[t];this.currentCollisions.get(e).has(i)||(-1!==this.eventListeners.indexOf(e)&&this.els.get(e).emit("collideend",{targetEl:this.els.get(i)}),-1!==this.eventListeners.indexOf(i)&&this.els.get(i).emit("collideend",{targetEl:this.els.get(e)}),o.splice(t,1))}this.currentCollisions.get(e).clear()}this.debugDrawer&&this.debugDrawer.update()},s.prototype.addConstraint=function(t){this.physicsWorld.addConstraint(t,!1)},s.prototype.removeConstraint=function(t){this.physicsWorld.removeConstraint(t)},s.prototype.addEventListener=function(t){this.eventListeners.push(Ammo.getPointer(t))},s.prototype.removeEventListener=function(t){const e=Ammo.getPointer(t);-1!==this.eventListeners.indexOf(e)&&this.eventListeners.splice(this.eventListeners.indexOf(e),1)},s.prototype.destroy=function(){Ammo.destroy(this.collisionConfiguration),Ammo.destroy(this.dispatcher),Ammo.destroy(this.broadphase),Ammo.destroy(this.solver),Ammo.destroy(this.physicsWorld),Ammo.destroy(this.debugDrawer)},s.prototype.getDebugDrawer=function(t,e){return this.debugDrawer||((e=e||{}).debugDrawMode=e.debugDrawMode||this.debugDrawMode,this.debugDrawer=new THREE.AmmoDebugDrawer(t,this.physicsWorld,e)),this.debugDrawer}},1778:function(t){function e(){}function o(){throw new Error("Method not implemented.")}t.exports=e,e.prototype.init=o,e.prototype.step=o,e.prototype.destroy=o,e.prototype.addBody=o,e.prototype.removeBody=o,e.prototype.applyBodyMethod=o,e.prototype.updateBodyProperties=o,e.prototype.addMaterial=o,e.prototype.addContactMaterial=o,e.prototype.addConstraint=o,e.prototype.removeConstraint=o,e.prototype.getContacts=o},1182:function(t){t.exports={INIT:"init",STEP:"step",ADD_BODY:"add-body",REMOVE_BODY:"remove-body",APPLY_BODY_METHOD:"apply-body-method",UPDATE_BODY_PROPERTIES:"update-body-properties",ADD_MATERIAL:"add-material",ADD_CONTACT_MATERIAL:"add-contact-material",ADD_CONSTRAINT:"add-constraint",REMOVE_CONSTRAINT:"remove-constraint",COLLIDE:"collide"}},598:function(t,e,o){var i=o(3687),s=o(1778);function n(){this.world=null,this.materials={},this.contactMaterial=null}n.prototype=new s,n.prototype.constructor=n,t.exports=n,n.prototype.init=function(t){var e=new i.World;e.quatNormalizeSkip=t.quatNormalizeSkip,e.quatNormalizeFast=t.quatNormalizeFast,e.solver.iterations=t.solverIterations,e.gravity.set(0,t.gravity,0),e.broadphase=new i.NaiveBroadphase,this.world=e},n.prototype.step=function(t){this.world.step(t)},n.prototype.destroy=function(){delete this.world,delete this.contactMaterial,this.materials={}},n.prototype.addBody=function(t){this.world.addBody(t)},n.prototype.removeBody=function(t){this.world.removeBody(t)},n.prototype.applyBodyMethod=function(t,e,o){t["__"+e].apply(t,o)},n.prototype.updateBodyProperties=function(){},n.prototype.getMaterial=function(t){return this.materials[t]},n.prototype.addMaterial=function(t){this.materials[t.name]=new i.Material(t),this.materials[t.name].name=t.name},n.prototype.addContactMaterial=function(t,e,o){var s=this.materials[t],n=this.materials[e];this.contactMaterial=new i.ContactMaterial(s,n,o),this.world.addContactMaterial(this.contactMaterial)},n.prototype.addConstraint=function(t){t.type||(t instanceof i.LockConstraint?t.type="LockConstraint":t instanceof i.DistanceConstraint?t.type="DistanceConstraint":t instanceof i.HingeConstraint?t.type="HingeConstraint":t instanceof i.ConeTwistConstraint?t.type="ConeTwistConstraint":t instanceof i.PointToPointConstraint&&(t.type="PointToPointConstraint")),this.world.addConstraint(t)},n.prototype.removeConstraint=function(t){this.world.removeConstraint(t)},n.prototype.getContacts=function(){return this.world.contacts}},8254:function(t,e,o){var i=o(1778);function s(){throw new Error("[NetworkDriver] Driver not implemented.")}s.prototype=new i,s.prototype.constructor=s,t.exports=s},9903:function(t){function e(){this.listeners=[]}t.exports=function(t){var o=new e,i=new e;return o.setTarget(i),i.setTarget(o),t(o),i},e.prototype.setTarget=function(t){this.target=t},e.prototype.addEventListener=function(t,e){this.listeners.push(e)},e.prototype.dispatchEvent=function(t,e){for(var o=0;o<this.listeners.length;o++)this.listeners[o](e)},e.prototype.postMessage=function(t){this.target.dispatchEvent("message",{data:t})}},7810:function(t,e,o){var i=o(8034),s=o(9903),n=o(1778),r=o(1182),a=o(3458),p=o(779),d=p.ID;function l(t){this.fps=t.fps,this.engine=t.engine,this.interpolate=t.interpolate,this.interpBufferSize=t.interpolationBufferSize,this.debug=t.debug,this.bodies={},this.contacts=[],this.frameDelay=1e3*this.interpBufferSize/this.fps,this.frameBuffer=[],this.worker=this.debug?s(a):i(a),this.worker.addEventListener("message",this._onMessage.bind(this))}l.prototype=new n,l.prototype.constructor=l,t.exports=l,l.prototype.init=function(t){this.worker.postMessage({type:r.INIT,worldConfig:t,fps:this.fps,engine:this.engine})},l.prototype.step=function(){if(this.interpolate){for(var t=this.frameBuffer[0],e=this.frameBuffer[1],o=performance.now();t&&e&&o-t.timestamp>this.frameDelay;)this.frameBuffer.shift(),t=this.frameBuffer[0],e=this.frameBuffer[1];if(t&&e){var i=(o-t.timestamp)/this.frameDelay;for(var s in i=(i-(1-1/this.interpBufferSize))*this.interpBufferSize,t.bodies)t.bodies.hasOwnProperty(s)&&e.bodies.hasOwnProperty(s)&&p.deserializeInterpBodyUpdate(t.bodies[s],e.bodies[s],this.bodies[s],i)}}},l.prototype.destroy=function(){this.worker.terminate(),delete this.worker},l.prototype._onMessage=function(t){if(t.data.type===r.STEP){var e=t.data.bodies;if(this.contacts=t.data.contacts,this.interpolate)this.frameBuffer.push({timestamp:performance.now(),bodies:e});else for(var o in e)e.hasOwnProperty(o)&&p.deserializeBodyUpdate(e[o],this.bodies[o])}else{if(t.data.type!==r.COLLIDE)throw new Error("[WorkerDriver] Unexpected message type.");var i=this.bodies[t.data.bodyID],s=this.bodies[t.data.targetID],n=p.deserializeContact(t.data.contact,this.bodies);if(!i._listeners||!i._listeners.collide)return;for(var a=0;a<i._listeners.collide.length;a++)i._listeners.collide[a]({target:s,body:i,contact:n})}},l.prototype.addBody=function(t){p.assignID("body",t),this.bodies[t[d]]=t,this.worker.postMessage({type:r.ADD_BODY,body:p.serializeBody(t)})},l.prototype.removeBody=function(t){this.worker.postMessage({type:r.REMOVE_BODY,bodyID:t[d]}),delete this.bodies[t[d]]},l.prototype.applyBodyMethod=function(t,e,o){switch(e){case"applyForce":case"applyImpulse":this.worker.postMessage({type:r.APPLY_BODY_METHOD,bodyID:t[d],methodName:e,args:[o[0].toArray(),o[1].toArray()]});break;default:throw new Error("Unexpected methodName: %s",e)}},l.prototype.updateBodyProperties=function(t){this.worker.postMessage({type:r.UPDATE_BODY_PROPERTIES,body:p.serializeBody(t)})},l.prototype.getMaterial=function(t){},l.prototype.addMaterial=function(t){this.worker.postMessage({type:r.ADD_MATERIAL,materialConfig:t})},l.prototype.addContactMaterial=function(t,e,o){this.worker.postMessage({type:r.ADD_CONTACT_MATERIAL,materialName1:t,materialName2:e,contactMaterialConfig:o})},l.prototype.addConstraint=function(t){t.type||(t instanceof CANNON.LockConstraint?t.type="LockConstraint":t instanceof CANNON.DistanceConstraint?t.type="DistanceConstraint":t instanceof CANNON.HingeConstraint?t.type="HingeConstraint":t instanceof CANNON.ConeTwistConstraint?t.type="ConeTwistConstraint":t instanceof CANNON.PointToPointConstraint&&(t.type="PointToPointConstraint")),p.assignID("constraint",t),this.worker.postMessage({type:r.ADD_CONSTRAINT,constraint:p.serializeConstraint(t)})},l.prototype.removeConstraint=function(t){this.worker.postMessage({type:r.REMOVE_CONSTRAINT,constraintID:t[d]})},l.prototype.getContacts=function(){var t=this.bodies;return this.contacts.map((function(e){return p.deserializeContact(e,t)}))}},3458:function(t,e,o){var i=o(1182),s=o(598),n=o(6203),r=o(779),a=r.ID;t.exports=function(t){var e,o=null,p={},d={};function l(){o.step(e);var s={};Object.keys(p).forEach((function(t){s[t]=r.serializeBody(p[t])})),t.postMessage({type:i.STEP,bodies:s,contacts:o.getContacts().map(r.serializeContact)})}t.addEventListener("message",(function(c){var h=c.data;switch(h.type){case i.INIT:(o="cannon"===h.engine?new s:new n).init(h.worldConfig),e=1/h.fps,setInterval(l,1e3/h.fps);break;case i.ADD_BODY:var y=r.deserializeBody(h.body);y.material=o.getMaterial("defaultMaterial"),p[y[a]]=y,y.addEventListener("collide",(function(e){var o={type:i.COLLIDE,bodyID:e.target[a],targetID:e.body[a],contact:r.serializeContact(e.contact)};t.postMessage(o)})),o.addBody(y);break;case i.REMOVE_BODY:o.removeBody(p[h.bodyID]),delete p[h.bodyID];break;case i.APPLY_BODY_METHOD:p[h.bodyID][h.methodName](r.deserializeVec3(h.args[0]),r.deserializeVec3(h.args[1]));break;case i.UPDATE_BODY_PROPERTIES:r.deserializeBodyUpdate(h.body,p[h.body.id]);break;case i.ADD_MATERIAL:o.addMaterial(h.materialConfig);break;case i.ADD_CONTACT_MATERIAL:o.addContactMaterial(h.materialName1,h.materialName2,h.contactMaterialConfig);break;case i.ADD_CONSTRAINT:var f=r.deserializeConstraint(h.constraint,p);d[f[a]]=f,o.addConstraint(f);break;case i.REMOVE_CONSTRAINT:o.removeConstraint(d[h.constraintID]),delete d[h.constraintID];break;default:throw new Error("[Worker] Unexpected event type: %s",h.type)}}))}}}]);