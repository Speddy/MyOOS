(self.webpackChunkmetaverse_experience=self.webpackChunkmetaverse_experience||[]).push([[505],{4921:function(t,e,s){const i=s(1416);AFRAME.registerComponent("clickable",AFRAME.utils.extendDeep({},i,{schema:{onclick:{type:"string"}},init:function(){this.CLICKED_STATE="clicked",this.CLICK_EVENT="grab-start",this.UNCLICK_EVENT="grab-end",this.clickers=[],this.start=this.start.bind(this),this.end=this.end.bind(this),this.el.addEventListener(this.CLICK_EVENT,this.start),this.el.addEventListener(this.UNCLICK_EVENT,this.end)},remove:function(){this.el.removeEventListener(this.CLICK_EVENT,this.start),this.el.removeEventListener(this.UNCLICK_EVENT,this.end)},start:function(t){!t.defaultPrevented&&this.startButtonOk(t)&&(this.el.addState(this.CLICKED_STATE),-1===this.clickers.indexOf(t.detail.hand)&&(this.clickers.push(t.detail.hand),t.preventDefault&&t.preventDefault()))},end:function(t){const e=this.clickers.indexOf(t.detail.hand);!t.defaultPrevented&&this.endButtonOk(t)&&(-1!==e&&this.clickers.splice(e,1),this.clickers.length<1&&this.el.removeState(this.CLICKED_STATE),t.preventDefault&&t.preventDefault())}}))},1708:function(t,e,s){const i=AFRAME.utils.extendDeep,r=s(1416);AFRAME.registerComponent("drag-droppable",i({},r,{init:function(){console.warn("Warning: drag-droppable is deprecated. Use draggable and droppable components instead"),this.HOVERED_STATE="dragover",this.DRAGGED_STATE="dragged",this.HOVER_EVENT="dragover-start",this.UNHOVER_EVENT="dragover-end",this.DRAG_EVENT="drag-start",this.UNDRAG_EVENT="drag-end",this.DRAGDROP_EVENT="drag-drop",this.hoverStart=this.hoverStart.bind(this),this.dragStart=this.dragStart.bind(this),this.hoverEnd=this.hoverEnd.bind(this),this.dragEnd=this.dragEnd.bind(this),this.dragDrop=this.dragDrop.bind(this),this.el.addEventListener(this.HOVER_EVENT,this.hoverStart),this.el.addEventListener(this.DRAG_EVENT,this.dragStart),this.el.addEventListener(this.UNHOVER_EVENT,this.hoverEnd),this.el.addEventListener(this.UNDRAG_EVENT,this.dragEnd),this.el.addEventListener(this.DRAGDROP_EVENT,this.dragDrop)},remove:function(){this.el.removeEventListener(this.HOVER_EVENT,this.hoverStart),this.el.removeEventListener(this.DRAG_EVENT,this.dragStart),this.el.removeEventListener(this.UNHOVER_EVENT,this.hoverEnd),this.el.removeEventListener(this.UNDRAG_EVENT,this.dragEnd),this.el.removeEventListener(this.DRAGDROP_EVENT,this.dragDrop)},hoverStart:function(t){this.el.addState(this.HOVERED_STATE),t.preventDefault&&t.preventDefault()},dragStart:function(t){this.startButtonOk(t)&&(this.el.addState(this.DRAGGED_STATE),t.preventDefault&&t.preventDefault())},hoverEnd:function(t){this.el.removeState(this.HOVERED_STATE)},dragEnd:function(t){this.endButtonOk(t)&&(this.el.removeState(this.DRAGGED_STATE),t.preventDefault&&t.preventDefault())},dragDrop:function(t){this.endButtonOk(t)&&t.preventDefault&&t.preventDefault()}}))},711:function(t,e,s){const i=AFRAME.utils.extendDeep,r=s(1416);AFRAME.registerComponent("draggable",i({},r,{init:function(){this.DRAGGED_STATE="dragged",this.DRAG_EVENT="drag-start",this.UNDRAG_EVENT="drag-end",this.dragStartBound=this.dragStart.bind(this),this.dragEndBound=this.dragEnd.bind(this),this.el.addEventListener(this.DRAG_EVENT,this.dragStartBound),this.el.addEventListener(this.UNDRAG_EVENT,this.dragEndBound)},remove:function(){this.el.removeEventListener(this.DRAG_EVENT,this.dragStart),this.el.removeEventListener(this.UNDRAG_EVENT,this.dragEnd)},dragStart:function(t){!t.defaultPrevented&&this.startButtonOk(t)&&(this.el.addState(this.DRAGGED_STATE),t.preventDefault&&t.preventDefault())},dragEnd:function(t){!t.defaultPrevented&&this.endButtonOk(t)&&(this.el.removeState(this.DRAGGED_STATE),t.preventDefault&&t.preventDefault())}}))},9514:function(){AFRAME.registerComponent("droppable",{schema:{accepts:{default:""},autoUpdate:{default:!0},acceptEvent:{default:""},rejectEvent:{default:""}},multiple:!0,init:function(){this.HOVERED_STATE="dragover",this.HOVER_EVENT="dragover-start",this.UNHOVER_EVENT="dragover-end",this.DRAGDROP_EVENT="drag-drop",this.hoverStartBound=this.hoverStart.bind(this),this.hoverEndBound=this.hoverEnd.bind(this),this.dragDropBound=this.dragDrop.bind(this),this.mutateAcceptsBound=this.mutateAccepts.bind(this),this.acceptableEntities=[],this.observer=new window.MutationObserver(this.mutateAcceptsBound),this.observerOpts={childList:!0,subtree:!0},this.el.addEventListener(this.HOVER_EVENT,this.hoverStartBound),this.el.addEventListener(this.UNHOVER_EVENT,this.hoverEndBound),this.el.addEventListener(this.DRAGDROP_EVENT,this.dragDropBound)},update:function(){this.data.accepts.length?this.acceptableEntities=Array.prototype.slice.call(this.el.sceneEl.querySelectorAll(this.data.accepts)):this.acceptableEntities=null,this.data.autoUpdate&&null!=this.acceptableEntities?this.observer.observe(this.el.sceneEl,this.observerOpts):this.observer.disconnect()},remove:function(){this.el.removeEventListener(this.HOVER_EVENT,this.hoverStartBound),this.el.removeEventListener(this.UNHOVER_EVENT,this.hoverEndBound),this.el.removeEventListener(this.DRAGDROP_EVENT,this.dragDropBound),this.observer.disconnect()},mutateAccepts:function(t){const e=this.data.accepts;t.forEach((t=>{t.addedNodes.forEach((t=>{var s,i;i=e,((s=t).matches?s.matches(i):s.msMatchesSelector?s.msMatchesSelector(i):s.webkitMatchesSelector?s.webkitMatchesSelector(i):void 0)&&this.acceptableEntities.push(t)}))}))},entityAcceptable:function(t){const e=this.acceptableEntities;if(null==e)return!0;for(const s of e)if(s===t)return!0;return!1},hoverStart:function(t){!t.defaultPrevented&&this.entityAcceptable(t.detail.carried)&&(this.el.addState(this.HOVERED_STATE),t.preventDefault&&t.preventDefault())},hoverEnd:function(t){t.defaultPrevented||this.el.removeState(this.HOVERED_STATE)},dragDrop:function(t){if(t.defaultPrevented)return;const e=t.detail.dropped;this.entityAcceptable(e)?(this.data.acceptEvent.length&&this.el.emit(this.data.acceptEvent,{el:e}),t.preventDefault&&t.preventDefault()):this.data.rejectEvent.length&&this.el.emit(this.data.rejectEvent,{el:e})}})},6832:function(t,e,s){const i=AFRAME.utils.extendDeep,r=i({},s(2945),s(1416));AFRAME.registerComponent("grabbable",i(r,{schema:{maxGrabbers:{type:"int",default:NaN},invert:{default:!1},suppressY:{default:!1}},init:function(){this.GRABBED_STATE="grabbed",this.GRAB_EVENT="grab-start",this.UNGRAB_EVENT="grab-end",this.grabbed=!1,this.grabbers=[],this.constraints=new Map,this.deltaPositionIsValid=!1,this.grabDistance=void 0,this.grabDirection={x:0,y:0,z:-1},this.grabOffset={x:0,y:0,z:0},this.destPosition={x:0,y:0,z:0},this.deltaPosition=new THREE.Vector3,this.targetPosition=new THREE.Vector3,this.physicsInit(),this.el.addEventListener(this.GRAB_EVENT,(t=>this.start(t))),this.el.addEventListener(this.UNGRAB_EVENT,(t=>this.end(t))),this.el.addEventListener("mouseout",(t=>this.lostGrabber(t)))},update:function(){this.physicsUpdate(),this.xFactor=this.data.invert?-1:1,this.zFactor=this.data.invert?-1:1,this.yFactor=(this.data.invert?-1:1)*!this.data.suppressY},tick:function(){const t=new THREE.Quaternion,e=new THREE.Vector3;return function(){let s;this.grabber&&(this.targetPosition.copy(this.grabDirection),this.targetPosition.applyQuaternion(this.grabber.object3D.getWorldQuaternion(t)).setLength(this.grabDistance).add(this.grabber.object3D.getWorldPosition(e)).add(this.grabOffset),this.deltaPositionIsValid?(this.deltaPosition.sub(this.targetPosition),s=this.el.getAttribute("position"),this.destPosition.x=s.x-this.deltaPosition.x*this.xFactor,this.destPosition.y=s.y-this.deltaPosition.y*this.yFactor,this.destPosition.z=s.z-this.deltaPosition.z*this.zFactor,this.el.setAttribute("position",this.destPosition)):this.deltaPositionIsValid=!0,this.deltaPosition.copy(this.targetPosition))}}(),remove:function(){this.el.removeEventListener(this.GRAB_EVENT,this.start),this.el.removeEventListener(this.UNGRAB_EVENT,this.end),this.physicsRemove()},start:function(t){if(t.defaultPrevented||!this.startButtonOk(t))return;const e=!Number.isFinite(this.data.maxGrabbers)||this.grabbers.length<this.data.maxGrabbers;if(-1===this.grabbers.indexOf(t.detail.hand)&&e){if(!t.detail.hand.object3D)return void console.warn("grabbable entities must have an object3D");this.grabbers.push(t.detail.hand),this.physicsStart(t)||this.grabber||(this.grabber=t.detail.hand,this.resetGrabber()),t.preventDefault&&t.preventDefault(),this.grabbed=!0,this.el.addState(this.GRABBED_STATE)}},end:function(t){const e=this.grabbers.indexOf(t.detail.hand);!t.defaultPrevented&&this.endButtonOk(t)&&(-1!==e&&(this.grabbers.splice(e,1),this.grabber=this.grabbers[0]),this.physicsEnd(t),this.resetGrabber()||(this.grabbed=!1,this.el.removeState(this.GRABBED_STATE)),t.preventDefault&&t.preventDefault())},resetGrabber:function(){const t=new THREE.Vector3,e=new THREE.Vector3;return function(){if(!this.grabber)return!1;const s=this.grabber.getAttribute("raycaster");return this.deltaPositionIsValid=!1,this.grabDistance=this.el.object3D.getWorldPosition(t).distanceTo(this.grabber.object3D.getWorldPosition(e)),s&&(this.grabDirection=s.direction,this.grabOffset=s.origin),!0}}(),lostGrabber:function(t){const e=this.grabbers.indexOf(t.relatedTarget);-1===e||t.relatedTarget===this.grabber||this.physicsIsConstrained(t.relatedTarget)||this.grabbers.splice(e,1)}}))},2585:function(){AFRAME.registerComponent("hoverable",{init:function(){this.HOVERED_STATE="hovered",this.HOVER_EVENT="hover-start",this.UNHOVER_EVENT="hover-end",this.hoverers=[],this.start=this.start.bind(this),this.end=this.end.bind(this),this.el.addEventListener(this.HOVER_EVENT,this.start),this.el.addEventListener(this.UNHOVER_EVENT,this.end)},remove:function(){this.el.removeEventListener(this.HOVER_EVENT,this.start),this.el.removeEventListener(this.UNHOVER_EVENT,this.end)},start:function(t){t.defaultPrevented||(this.el.addState(this.HOVERED_STATE),-1===this.hoverers.indexOf(t.detail.hand)&&this.hoverers.push(t.detail.hand),t.preventDefault&&t.preventDefault())},end:function(t){if(t.defaultPrevented)return;const e=this.hoverers.indexOf(t.detail.hand);-1!==e&&this.hoverers.splice(e,1),this.hoverers.length<1&&this.el.removeState(this.HOVERED_STATE)}})},1416:function(t){t.exports=function(){function t(t,e){return 0===e.length||-1!==e.indexOf(t.detail.buttonEvent.type)}return{schema:{startButtons:{default:[]},endButtons:{default:[]}},startButtonOk:function(e){return t(e,this.data.startButtons)},endButtonOk:function(e){return t(e,this.data.endButtons)}}}()},2945:function(t){t.exports={schema:{usePhysics:{default:"ifavailable"}},physicsInit:function(){this.constraints=new Map},physicsUpdate:function(){"never"===this.data.usePhysics&&this.constraints.size&&this.physicsClear()},physicsRemove:function(){this.physicsClear()},physicsStart:function(t){if("never"!==this.data.usePhysics&&this.el.body&&t.detail.hand.body&&!this.constraints.has(t.detail.hand)){const e=Math.random().toString(36).substr(2,9);return this.el.setAttribute("constraint__"+e,{target:t.detail.hand}),this.constraints.set(t.detail.hand,e),!0}return"only"===this.data.usePhysics},physicsEnd:function(t){const e=this.constraints.get(t.detail.hand);e&&(this.el.removeAttribute("constraint__"+e),this.constraints.delete(t.detail.hand))},physicsClear:function(){if(this.el.body)for(const t of this.constraints.values())this.el.body.world.removeConstraint(t);this.constraints.clear()},physicsIsConstrained:function(t){return this.constraints.has(t)},physicsIsGrabbing(){return this.constraints.size>0}}},4336:function(t,e,s){const i=AFRAME.utils.extendDeep,r=i({},s(1416));AFRAME.registerComponent("stretchable",i(r,{schema:{usePhysics:{default:"ifavailable"},invert:{default:!1},physicsUpdateRate:{default:100}},init:function(){this.STRETCHED_STATE="stretched",this.STRETCH_EVENT="stretch-start",this.UNSTRETCH_EVENT="stretch-end",this.stretched=!1,this.stretchers=[],this.scale=new THREE.Vector3,this.handPos=new THREE.Vector3,this.otherHandPos=new THREE.Vector3,this.start=this.start.bind(this),this.end=this.end.bind(this),this.el.addEventListener(this.STRETCH_EVENT,this.start),this.el.addEventListener(this.UNSTRETCH_EVENT,this.end)},update:function(t){this.updateBodies=AFRAME.utils.throttleTick(this._updateBodies,this.data.physicsUpdateRate,this)},tick:function(t,e){if(!this.stretched)return;this.scale.copy(this.el.getAttribute("scale")),this.stretchers[0].object3D.getWorldPosition(this.handPos),this.stretchers[1].object3D.getWorldPosition(this.otherHandPos);const s=this.handPos.distanceTo(this.otherHandPos);let i=1;null!==this.previousStretch&&0!==s&&(i=Math.pow(s/this.previousStretch,this.data.invert?-1:1)),this.previousStretch=s,null==this.previousPhysicsStretch&&(this.previousPhysicsStretch=s),this.scale.multiplyScalar(i),this.el.setAttribute("scale",this.scale),this.updateBodies(t,e)},remove:function(){this.el.removeEventListener(this.STRETCH_EVENT,this.start),this.el.removeEventListener(this.UNSTRETCH_EVENT,this.end)},start:function(t){this.stretched||this.stretchers.includes(t.detail.hand)||!this.startButtonOk(t)||t.defaultPrevented||(this.stretchers.push(t.detail.hand),2===this.stretchers.length&&(this.stretched=!0,this.previousStretch=null,this.previousPhysicsStretch=null,this.el.addState(this.STRETCHED_STATE)),t.preventDefault&&t.preventDefault())},end:function(t){const e=this.stretchers.indexOf(t.detail.hand);!t.defaultPrevented&&this.endButtonOk(t)&&(-1!==e&&(this.stretchers.splice(e,1),this.stretched=!1,this.el.removeState(this.STRETCHED_STATE),this._updateBodies()),t.preventDefault&&t.preventDefault())},_updateBodies:function(){if(!this.el.body||"never"===this.data.usePhysics)return;const t=this.previousStretch;let e=1;if(null!==this.previousPhysicsStretch&&t>0&&(e=Math.pow(t/this.previousPhysicsStretch,this.data.invert?-1:1)),this.previousPhysicsStretch=t,1!==e){for(const t of this.el.childNodes)this.stretchBody(t,e);this.stretchBody(this.el,e)}},stretchBody:function(t,e){if(!t.body)return;let s,i;for(let r=0;r<t.body.shapes.length;r++)s=t.body.shapes[r],s.halfExtents?(s.halfExtents.scale(e,s.halfExtents),s.updateConvexPolyhedronRepresentation()):s.radius?(s.radius*=e,s.updateBoundingSphereRadius()):this.shapeWarned||(console.warn("Unable to stretch physics body: unsupported shape"),this.shapeWarned=!0),i=t.body.shapeOffsets[r],i.scale(e,i);t.body.updateBoundingRadius()}}))},2040:function(){AFRAME.registerSystem("super-hands",{init:function(){this.superHands=[]},registerMe:function(t){1===this.superHands.length&&(this.superHands[0].otherSuperHand=t,t.otherSuperHand=this.superHands[0]),this.superHands.push(t)},unregisterMe:function(t){const e=this.superHands.indexOf(t);-1!==e&&this.superHands.splice(e,1),this.superHands.forEach((e=>{e.otherSuperHand===t&&(e.otherSuperHand=null)}))}})},8139:function(t,e,s){"use strict";s.d(e,{MA:function(){return h},Rq:function(){return o},ZH:function(){return a}});const i=[];function r(t,e,s=((t,e)=>t===e)){if(t===e)return!0;if(!t||!e)return!1;const i=t.length;if(e.length!==i)return!1;for(let r=0;r<i;r++)if(!s(t[r],e[r]))return!1;return!0}function n(t,e=null,s=!1,n={}){null===e&&(e=[t]);for(const t of i)if(r(e,t.keys,t.equal)){if(s)return;if(Object.prototype.hasOwnProperty.call(t,"error"))throw t.error;if(Object.prototype.hasOwnProperty.call(t,"response"))return n.lifespan&&n.lifespan>0&&(t.timeout&&clearTimeout(t.timeout),t.timeout=setTimeout(t.remove,n.lifespan)),t.response;if(!s)throw t.promise}const o={keys:e,equal:n.equal,remove:()=>{const t=i.indexOf(o);-1!==t&&i.splice(t,1)},promise:(h=t,"object"==typeof h&&"function"==typeof h.then?t:t(...e)).then((t=>{o.response=t,n.lifespan&&n.lifespan>0&&(o.timeout=setTimeout(o.remove,n.lifespan))})).catch((t=>o.error=t))};var h;if(i.push(o),!s)throw o.promise}const o=(t,e,s)=>n(t,e,!1,s),h=(t,e,s)=>{n(t,e,!0,s)},a=t=>{if(void 0===t||0===t.length)i.splice(0,i.length);else{const e=i.find((e=>r(t,e.keys,e.equal)));e&&e.remove()}}},6594:function(t,e,s){"use strict";s.r(e),s.d(e,{Pathfinding:function(){return h},PathfindingHelper:function(){return c}});var i=s(9477);class r{static roundNumber(t,e){const s=Math.pow(10,e);return Math.round(t*s)/s}static sample(t){return t[Math.floor(Math.random()*t.length)]}static distanceToSquared(t,e){var s=t.x-e.x,i=t.y-e.y,r=t.z-e.z;return s*s+i*i+r*r}static isPointInPoly(t,e){for(var s=!1,i=-1,r=t.length,n=r-1;++i<r;n=i)(t[i].z<=e.z&&e.z<t[n].z||t[n].z<=e.z&&e.z<t[i].z)&&e.x<(t[n].x-t[i].x)*(e.z-t[i].z)/(t[n].z-t[i].z)+t[i].x&&(s=!s);return s}static isVectorInPolygon(t,e,s){var i=1e5,r=-1e5,n=[];return e.vertexIds.forEach((t=>{i=Math.min(s[t].y,i),r=Math.max(s[t].y,r),n.push(s[t])})),!!(t.y<r+.5&&t.y>i-.5&&this.isPointInPoly(n,t))}static triarea2(t,e,s){return(s.x-t.x)*(e.z-t.z)-(e.x-t.x)*(s.z-t.z)}static vequal(t,e){return this.distanceToSquared(t,e)<1e-5}static mergeVertices(t,e=1e-4){e=Math.max(e,Number.EPSILON);for(var s={},r=t.getIndex(),n=t.getAttribute("position"),o=r?r.count:n.count,h=0,a=[],c=[],d=Math.log10(1/e),u=Math.pow(10,d),l=0;l<o;l++){var p=r?r.getX(l):l,E="";E+=~~(n.getX(p)*u)+",",E+=~~(n.getY(p)*u)+",",(E+=~~(n.getZ(p)*u)+",")in s?a.push(s[E]):(c.push(n.getX(p)),c.push(n.getY(p)),c.push(n.getZ(p)),s[E]=h,a.push(h),h++)}const f=new i.BufferAttribute(new Float32Array(c),n.itemSize,n.normalized),v=new i.BufferGeometry;return v.setAttribute("position",f),v.setIndex(a),v}}class n{constructor(t){this.content=[],this.scoreFunction=t}push(t){this.content.push(t),this.sinkDown(this.content.length-1)}pop(){const t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.bubbleUp(0)),t}remove(t){const e=this.content.indexOf(t),s=this.content.pop();e!==this.content.length-1&&(this.content[e]=s,this.scoreFunction(s)<this.scoreFunction(t)?this.sinkDown(e):this.bubbleUp(e))}size(){return this.content.length}rescoreElement(t){this.sinkDown(this.content.indexOf(t))}sinkDown(t){const e=this.content[t];for(;t>0;){const s=(t+1>>1)-1,i=this.content[s];if(!(this.scoreFunction(e)<this.scoreFunction(i)))break;this.content[s]=e,this.content[t]=i,t=s}}bubbleUp(t){const e=this.content.length,s=this.content[t],i=this.scoreFunction(s);for(;;){const r=t+1<<1,n=r-1;let o,h=null;if(n<e&&(o=this.scoreFunction(this.content[n]),o<i&&(h=n)),r<e&&this.scoreFunction(this.content[r])<(null===h?i:o)&&(h=r),null===h)break;this.content[t]=this.content[h],this.content[h]=s,t=h}}}class o{constructor(){this.portals=[]}push(t,e){void 0===e&&(e=t),this.portals.push({left:t,right:e})}stringPull(){const t=this.portals,e=[];let s,i,n,o=0,h=0,a=0;s=t[0].left,i=t[0].left,n=t[0].right,e.push(s);for(let c=1;c<t.length;c++){const d=t[c].left,u=t[c].right;if(r.triarea2(s,n,u)<=0){if(!(r.vequal(s,n)||r.triarea2(s,i,u)>0)){e.push(i),s=i,o=h,i=s,n=s,h=o,a=o,c=o;continue}n=u,a=c}if(r.triarea2(s,i,d)>=0){if(!(r.vequal(s,i)||r.triarea2(s,n,d)<0)){e.push(n),s=n,o=a,i=s,n=s,h=o,a=o,c=o;continue}i=d,h=c}}return 0!==e.length&&r.vequal(e[e.length-1],t[t.length-1].left)||e.push(t[t.length-1].left),this.path=e,e}}class h{constructor(){this.zones={}}static createZone(t,e=1e-4){return class{static buildZone(t,e){const s=this._buildNavigationMesh(t,e),n={};s.vertices.forEach((t=>{t.x=r.roundNumber(t.x,2),t.y=r.roundNumber(t.y,2),t.z=r.roundNumber(t.z,2)})),n.vertices=s.vertices;const o=this._buildPolygonGroups(s);return n.groups=new Array(o.length),o.forEach(((t,e)=>{const s=new Map;t.forEach(((t,e)=>{s.set(t,e)}));const o=new Array(t.length);t.forEach(((t,e)=>{const h=[];t.neighbours.forEach((t=>h.push(s.get(t))));const a=[];t.neighbours.forEach((e=>a.push(this._getSharedVerticesInOrder(t,e))));const c=new i.Vector3(0,0,0);c.add(n.vertices[t.vertexIds[0]]),c.add(n.vertices[t.vertexIds[1]]),c.add(n.vertices[t.vertexIds[2]]),c.divideScalar(3),c.x=r.roundNumber(c.x,2),c.y=r.roundNumber(c.y,2),c.z=r.roundNumber(c.z,2),o[e]={id:e,neighbours:h,vertexIds:t.vertexIds,centroid:c,portals:a}})),n.groups[e]=o})),n}static _buildNavigationMesh(t,e){return t=r.mergeVertices(t,e),this._buildPolygonsFromGeometry(t)}static _spreadGroupId(t){let e=new Set([t]);for(;e.size>0;){const s=e;e=new Set,s.forEach((s=>{s.group=t.group,s.neighbours.forEach((t=>{void 0===t.group&&e.add(t)}))}))}}static _buildPolygonGroups(t){const e=[];return t.polygons.forEach((t=>{void 0!==t.group?e[t.group].push(t):(t.group=e.length,this._spreadGroupId(t),e.push([t]))})),e}static _buildPolygonNeighbours(t,e){const s=new Set,i=e[t.vertexIds[1]],r=e[t.vertexIds[2]];return e[t.vertexIds[0]].forEach((e=>{e!==t&&(i.includes(e)||r.includes(e))&&s.add(e)})),i.forEach((e=>{e!==t&&r.includes(e)&&s.add(e)})),s}static _buildPolygonsFromGeometry(t){const e=[],s=[],r=t.attributes.position,n=t.index,o=[];for(let t=0;t<r.count;t++)s.push((new i.Vector3).fromBufferAttribute(r,t)),o[t]=[];for(let s=0;s<t.index.count;s+=3){const t=n.getX(s),i=n.getX(s+1),r=n.getX(s+2),h={vertexIds:[t,i,r],neighbours:null};e.push(h),o[t].push(h),o[i].push(h),o[r].push(h)}return e.forEach((t=>{t.neighbours=this._buildPolygonNeighbours(t,o)})),{polygons:e,vertices:s}}static _getSharedVerticesInOrder(t,e){const s=t.vertexIds,i=s[0],r=s[1],n=s[2],o=e.vertexIds,h=o.includes(i),a=o.includes(r),c=o.includes(n);return h&&a&&c?Array.from(s):h&&a?[i,r]:a&&c?[r,n]:h&&c?[n,i]:(console.warn("Error processing navigation mesh neighbors; neighbors with <2 shared vertices found."),[])}}.buildZone(t,e)}setZoneData(t,e){this.zones[t]=e}getRandomNode(t,e,s,n){if(!this.zones[t])return new i.Vector3;s=s||null,n=n||0;const o=[];return this.zones[t].groups[e].forEach((t=>{s&&n?r.distanceToSquared(s,t.centroid)<n*n&&o.push(t.centroid):o.push(t.centroid)})),r.sample(o)||new i.Vector3}getClosestNode(t,e,s,i=!1){const n=this.zones[e].vertices;let o=null,h=1/0;return this.zones[e].groups[s].forEach((e=>{const s=r.distanceToSquared(e.centroid,t);s<h&&(!i||r.isVectorInPolygon(t,e,n))&&(o=e,h=s)})),o}findPath(t,e,s,h){const a=this.zones[s].groups[h],c=this.zones[s].vertices,d=this.getClosestNode(t,s,h,!0),u=this.getClosestNode(e,s,h,!0);if(!d||!u)return null;const l=class{static init(t){for(let e=0;e<t.length;e++){const s=t[e];s.f=0,s.g=0,s.h=0,s.cost=1,s.visited=!1,s.closed=!1,s.parent=null}}static cleanUp(t){for(let e=0;e<t.length;e++){const s=t[e];delete s.f,delete s.g,delete s.h,delete s.cost,delete s.visited,delete s.closed,delete s.parent}}static heap(){return new n((function(t){return t.f}))}static search(t,e,s){this.init(t);const i=this.heap();for(i.push(e);i.size()>0;){const e=i.pop();if(e===s){let t=e;const s=[];for(;t.parent;)s.push(t),t=t.parent;return this.cleanUp(s),s.reverse()}e.closed=!0;const r=this.neighbours(t,e);for(let t=0,n=r.length;t<n;t++){const n=r[t];if(n.closed)continue;const o=e.g+n.cost,h=n.visited;if(!h||o<n.g){if(n.visited=!0,n.parent=e,!n.centroid||!s.centroid)throw new Error("Unexpected state");n.h=n.h||this.heuristic(n.centroid,s.centroid),n.g=o,n.f=n.g+n.h,h?i.rescoreElement(n):i.push(n)}}}return[]}static heuristic(t,e){return r.distanceToSquared(t,e)}static neighbours(t,e){const s=[];for(let i=0;i<e.neighbours.length;i++)s.push(t[e.neighbours[i]]);return s}}.search(a,d,u),p=function(t,e){for(var s=0;s<t.neighbours.length;s++)if(t.neighbours[s]===e.id)return t.portals[s]},E=new o;E.push(t);for(let t=0;t<l.length;t++){const e=l[t],s=l[t+1];if(s){const t=p(e,s);E.push(c[t[0]],c[t[1]])}}E.push(e),E.stringPull();const f=E.path.map((t=>new i.Vector3(t.x,t.y,t.z)));return f.shift(),f}}h.prototype.getGroup=function(){const t=new i.Plane;return function(e,s,i=!1){if(!this.zones[e])return null;let n=null,o=Math.pow(50,2);const h=this.zones[e];for(let e=0;e<h.groups.length;e++){const a=h.groups[e];for(const c of a){if(i&&(t.setFromCoplanarPoints(h.vertices[c.vertexIds[0]],h.vertices[c.vertexIds[1]],h.vertices[c.vertexIds[2]]),Math.abs(t.distanceToPoint(s))<.01)&&r.isPointInPoly([h.vertices[c.vertexIds[0]],h.vertices[c.vertexIds[1]],h.vertices[c.vertexIds[2]]],s))return e;const a=r.distanceToSquared(c.centroid,s);a<o&&(n=e,o=a)}}return n}}(),h.prototype.clampStep=function(){const t=new i.Vector3,e=new i.Plane,s=new i.Triangle,r=new i.Vector3;let n,o,h=new i.Vector3;return function(i,a,c,d,u,l){const p=this.zones[d].vertices,E=this.zones[d].groups[u],f=[c],v={};v[c.id]=0,n=void 0,h.set(0,0,0),o=1/0,e.setFromCoplanarPoints(p[c.vertexIds[0]],p[c.vertexIds[1]],p[c.vertexIds[2]]),e.projectPoint(a,t),r.copy(t);for(let e=f.pop();e;e=f.pop()){s.set(p[e.vertexIds[0]],p[e.vertexIds[1]],p[e.vertexIds[2]]),s.closestPointToPoint(r,t),t.distanceToSquared(r)<o&&(n=e,h.copy(t),o=t.distanceToSquared(r));const i=v[e.id];if(!(i>2))for(let t=0;t<e.neighbours.length;t++){const s=E[e.neighbours[t]];s.id in v||(f.push(s),v[s.id]=i+1)}}return l.copy(h),n}}();const a={PLAYER:new i.Color(15631215).convertSRGBToLinear().getHex(),TARGET:new i.Color(14469912).convertSRGBToLinear().getHex(),PATH:new i.Color(41903).convertSRGBToLinear().getHex(),WAYPOINT:new i.Color(41903).convertSRGBToLinear().getHex(),CLAMPED_STEP:new i.Color(14472114).convertSRGBToLinear().getHex(),CLOSEST_NODE:new i.Color(4417387).convertSRGBToLinear().getHex()};class c extends i.Object3D{constructor(){super(),this._playerMarker=new i.Mesh(new i.SphereGeometry(.25,32,32),new i.MeshBasicMaterial({color:a.PLAYER})),this._targetMarker=new i.Mesh(new i.BoxGeometry(.3,.3,.3),new i.MeshBasicMaterial({color:a.TARGET})),this._nodeMarker=new i.Mesh(new i.BoxGeometry(.1,.8,.1),new i.MeshBasicMaterial({color:a.CLOSEST_NODE})),this._stepMarker=new i.Mesh(new i.BoxGeometry(.1,1,.1),new i.MeshBasicMaterial({color:a.CLAMPED_STEP})),this._pathMarker=new i.Object3D,this._pathLineMaterial=new i.LineBasicMaterial({color:a.PATH,linewidth:2}),this._pathPointMaterial=new i.MeshBasicMaterial({color:a.WAYPOINT}),this._pathPointGeometry=new i.SphereGeometry(.08),this._markers=[this._playerMarker,this._targetMarker,this._nodeMarker,this._stepMarker,this._pathMarker],this._markers.forEach((t=>{t.visible=!1,this.add(t)}))}setPath(t){for(;this._pathMarker.children.length;)this._pathMarker.children[0].visible=!1,this._pathMarker.remove(this._pathMarker.children[0]);t=[this._playerMarker.position].concat(t);const e=new i.BufferGeometry;e.setAttribute("position",new i.BufferAttribute(new Float32Array(3*t.length),3));for(let s=0;s<t.length;s++)e.attributes.position.setXYZ(s,t[s].x,t[s].y+.2,t[s].z);this._pathMarker.add(new i.Line(e,this._pathLineMaterial));for(let e=0;e<t.length-1;e++){const s=new i.Mesh(this._pathPointGeometry,this._pathPointMaterial);s.position.copy(t[e]),s.position.y+=.2,this._pathMarker.add(s)}return this._pathMarker.visible=!0,this}setPlayerPosition(t){return this._playerMarker.position.copy(t),this._playerMarker.visible=!0,this}setTargetPosition(t){return this._targetMarker.position.copy(t),this._targetMarker.visible=!0,this}setNodePosition(t){return this._nodeMarker.position.copy(t),this._nodeMarker.visible=!0,this}setStepPosition(t){return this._stepMarker.position.copy(t),this._stepMarker.visible=!0,this}reset(){for(;this._pathMarker.children.length;)this._pathMarker.children[0].visible=!1,this._pathMarker.remove(this._pathMarker.children[0]);return this._markers.forEach((t=>{t.visible=!1})),this}}},8034:function(t){var e=arguments[3],s=arguments[4],i=arguments[5],r=JSON.stringify;t.exports=function(t,n){for(var o,h=Object.keys(i),a=0,c=h.length;a<c;a++){var d=h[a],u=i[d].exports;if(u===t||u&&u.default===t){o=d;break}}if(!o){o=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var l={};for(a=0,c=h.length;a<c;a++){l[d=h[a]]=d}s[o]=["function(require,module,exports){"+t+"(self); }",l]}var p=Math.floor(Math.pow(16,8)*Math.random()).toString(16),E={};E[o]=o,s[p]=["function(require,module,exports){var f = require("+r(o)+");(f.default ? f.default : f)(self);}",E];var f={};!function t(e){for(var i in f[e]=!0,s[e][1]){var r=s[e][1][i];f[r]||t(r)}}(p);var v="("+e+")({"+Object.keys(f).map((function(t){return r(t)+":["+s[t][0]+","+r(s[t][1])+"]"})).join(",")+"},{},["+r(p)+"])",g=window.URL||window.webkitURL||window.mozURL||window.msURL,b=new Blob([v],{type:"text/javascript"});if(n&&n.bare)return b;var T=g.createObjectURL(b),y=new Worker(T);return y.objectURL=T,y}}}]);